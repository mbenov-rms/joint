/*! JointJS v0.9.3 - JavaScript diagramming library  2015-04-15 


This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
(function(){function a(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}function b(b,c){var d=typeof c;if(b=b.cache,"boolean"==d||null==c)return b[c]?0:-1;"number"!=d&&"string"!=d&&(d="object");var e="number"==d?c:s+c;return b=(b=b[d])&&b[e],"object"==d?b&&a(b,c)>-1?0:-1:b?0:-1}function c(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:s+a,e=b[c]||(b[c]={});"object"==c?(e[d]||(e[d]=[])).push(a):e[d]=!0}}function d(a){return a.charCodeAt(0)}function e(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||"undefined"==typeof c)return 1;if(d>c||"undefined"==typeof d)return-1}return a.index-b.index}function f(a){var b=-1,d=a.length,e=a[0],f=a[d/2|0],g=a[d-1];if(e&&"object"==typeof e&&f&&"object"==typeof f&&g&&"object"==typeof g)return!1;var h=i();h["false"]=h["null"]=h["true"]=h.undefined=!1;var j=i();for(j.array=a,j.cache=h,j.push=c;++b<d;)j.push(a[b]);return j}function g(a){return"\\"+W[a]}function h(){return p.pop()||[]}function i(){return q.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function j(){}function k(a){a.length=0,p.length<u&&p.push(a)}function l(a){var b=a.cache;b&&l(b),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,q.length<u&&q.push(a)}function m(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function n(c){function p(a){return a&&"object"==typeof a&&!Xc(a)&&yc.call(a,"__wrapped__")?a:new q(a)}function q(a,b){this.__chain__=!!b,this.__wrapped__=a}function u(a,b,c,d,e){if(c){var f=c(a);if("undefined"!=typeof f)return f}var g=Aa(a);if(!g)return a;var i=Ec.call(a);if(!S[i])return a;var j=Uc[i];switch(i){case L:case M:return new j(+a);case O:case R:return new j(a);case Q:return f=j(a.source,A.exec(a)),f.lastIndex=a.lastIndex,f}var l=Xc(a);if(b){var n=!d;d||(d=h()),e||(e=h());for(var o=d.length;o--;)if(d[o]==a)return e[o];f=l?j(a.length):{}}else f=l?m(a):cd({},a);return l&&(yc.call(a,"index")&&(f.index=a.index),yc.call(a,"input")&&(f.input=a.input)),b?(d.push(a),e.push(f),(l?Ta:fd)(a,function(a,g){f[g]=u(a,b,c,d,e)}),n&&(k(d),k(e)),f):f}function W(a,b,c){if("function"!=typeof a)return Tb;if("undefined"==typeof b)return a;var d=a.__bindData__||Vc.funcNames&&!a.name;if("undefined"==typeof d){var e=F&&wc.call(a);Vc.funcNames||!e||B.test(e)||(d=!0),(Vc.funcNames||!d)&&(d=!Vc.funcDecomp||F.test(e),Wc(a,d))}if(d!==!0&&d&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Db(a,b)}function Y(a,b,c,d){for(var e=(d||0)-1,f=a?a.length:0,g=[];++e<f;){var h=a[e];if(h&&"object"==typeof h&&"number"==typeof h.length&&(Xc(h)||ja(h))){b||(h=Y(h,b,c));var i=-1,j=h.length,k=g.length;for(g.length+=j;++i<j;)g[k++]=h[i]}else c||g.push(h)}return g}function Z(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;var i=typeof a,j=typeof b;if(!(a!==a||a&&V[i]||b&&V[j]))return!1;if(null==a||null==b)return a===b;var l=Ec.call(a),m=Ec.call(b);if(l==J&&(l=P),m==J&&(m=P),l!=m)return!1;switch(l){case L:case M:return+a==+b;case O:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case Q:case R:return a==nc(b)}var n=l==K;if(!n){if(yc.call(a,"__wrapped__ ")||yc.call(b,"__wrapped__"))return Z(a.__wrapped__||a,b.__wrapped__||b,c,d,e,f);if(l!=P)return!1;var o=a.constructor,p=b.constructor;if(o!=p&&!(za(o)&&o instanceof o&&za(p)&&p instanceof p))return!1}var q=!e;e||(e=h()),f||(f=h());for(var r=e.length;r--;)if(e[r]==a)return f[r]==b;var s=0;if(g=!0,e.push(a),f.push(b),n){if(r=a.length,s=b.length,g=s==a.length,!g&&!d)return g;for(;s--;){var t=r,u=b[s];if(d)for(;t--&&!(g=Z(a[t],u,c,d,e,f)););else if(!(g=Z(a[s],u,c,d,e,f)))break}return g}return ed(b,function(b,h,i){return yc.call(i,h)?(s++,g=yc.call(a,h)&&Z(a[h],b,c,d,e,f)):void 0}),g&&!d&&ed(a,function(a,b,c){return yc.call(c,b)?g=--s>-1:void 0}),q&&(k(e),k(f)),g}function _(a,b,c,d,e){(Xc(b)?Ta:fd)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Xc(b))||gd(b))){for(var k=d.length;k--;)if(g=d[k]==b){j=e[k];break}if(!g){var l;c&&(i=c(j,b),(l="undefined"!=typeof i)&&(j=i)),l||(j=h?Xc(j)?j:[]:gd(j)?j:{}),d.push(b),e.push(j),l||_(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function ba(c,d,e){var g=-1,i=ga(),j=c?c.length:0,m=[],n=!d&&j>=t&&i===a,o=e||n?h():m;if(n){var p=f(o);p?(i=b,o=p):(n=!1,o=e?o:(k(o),m))}for(;++g<j;){var q=c[g],r=e?e(q,g,c):q;(d?!g||o[o.length-1]!==r:i(o,r)<0)&&((e||n)&&o.push(r),m.push(q))}return n?(k(o.array),l(o)):e&&k(o),m}function ca(a){return function(b,c,d){var e={};c=p.createCallback(c,d,3);var f=-1,g=b?b.length:0;if("number"==typeof g)for(;++f<g;){var h=b[f];a(e,h,c(h,f,b),b)}else fd(b,function(b,d,f){a(e,b,c(b,d,f),f)});return e}}function da(a,b,c,d,e,f){var g=1&b,h=2&b,i=4&b,j=8&b,k=16&b,l=32&b,m=a;if(!h&&!za(a))throw new oc;k&&!c.length&&(b&=-17,k=c=!1),l&&!d.length&&(b&=-33,l=d=!1);var n=a&&a.__bindData__;if(n)return!g||1&n[1]||(n[4]=e),!g&&1&n[1]&&(b|=8),!i||4&n[1]||(n[5]=f),k&&Ac.apply(n[2]||(n[2]=[]),c),l&&Ac.apply(n[3]||(n[3]=[]),d),n[1]|=b,da.apply(null,n);if(g&&!(h||i||l)&&(Vc.fastBind||Hc&&k)){if(k){var o=[e];Ac.apply(o,c)}var p=k?Hc.apply(a,o):Hc.call(a,e)}else p=function(){var n=arguments,o=g?e:this;if((i||k||l)&&(n=Rc.call(n),k&&Fc.apply(n,c),l&&Ac.apply(n,d),i&&n.length<f))return b|=16,da(a,j?b:-4&b,n,null,e,f);if(h&&(a=o[m]),this instanceof p){o=ea(a.prototype);var q=a.apply(o,n);return Aa(q)?q:o}return a.apply(o,n)};return Wc(p,Rc.call(arguments)),p}function ea(a){return Aa(a)?Ic(a):{}}function fa(a){return $c[a]}function ga(){var b=(b=p.indexOf)===nb?a:b;return b}function ha(a){var b,c;return a&&Ec.call(a)==P&&(b=a.constructor,!za(b)||b instanceof b)?(ed(a,function(a,b){c=b}),"undefined"==typeof c||yc.call(a,c)):!1}function ia(a){return _c[a]}function ja(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ec.call(a)==J||!1}function ka(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),u(a,b,"function"==typeof c&&W(c,d,1))}function la(a,b,c){return u(a,!0,"function"==typeof b&&W(b,c,1))}function ma(a,b,c){var d;return b=p.createCallback(b,c,3),fd(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d}function na(a,b,c){var d;return b=p.createCallback(b,c,3),pa(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d}function oa(a,b,c){var d=[];ed(a,function(a,b){d.push(b,a)});var e=d.length;for(b=W(b,c,3);e--&&b(d[e--],d[e],a)!==!1;);return a}function pa(a,b,c){var d=Zc(a),e=d.length;for(b=W(b,c,3);e--;){var f=d[e];if(b(a[f],f,a)===!1)break}return a}function qa(a){var b=[];return ed(a,function(a,c){za(a)&&b.push(c)}),b.sort()}function ra(a,b){return a?yc.call(a,b):!1}function sa(a){for(var b=-1,c=Zc(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function ta(a){return a===!0||a===!1||Ec.call(a)==L}function ua(a){return a?"object"==typeof a&&Ec.call(a)==M:!1}function va(a){return a?1===a.nodeType:!1}function wa(a){var b=!0;if(!a)return b;var c=Ec.call(a),d=a.length;return c==K||c==R||c==J||c==P&&"number"==typeof d&&za(a.splice)?!d:(fd(a,function(){return b=!1}),b)}function xa(a,b,c,d){return Z(a,b,"function"==typeof c&&W(c,d,2))}function ya(a){return Kc(a)&&!Lc(parseFloat(a))}function za(a){return"function"==typeof a}function Aa(a){return!(!a||!V[typeof a])}function Ba(a){return Da(a)&&a!=+a}function Ca(a){return null===a}function Da(a){return"number"==typeof a||Ec.call(a)==O}function Ea(a){return a?"object"==typeof a&&Ec.call(a)==Q:!1}function Fa(a){return"string"==typeof a||Ec.call(a)==R}function Ga(a){return"undefined"==typeof a}function Ha(a){var b=arguments,c=2;if(!Aa(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=W(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var e=Rc.call(arguments,1,c),f=-1,g=h(),i=h();++f<c;)_(a,e[f],d,g,i);return k(g),k(i),a}function Ia(a,b,c){var d=ga(),e="function"==typeof b,f={};if(e)b=p.createCallback(b,c,3);else var g=Y(arguments,!0,!1,1);return ed(a,function(a,c,h){(e?!b(a,c,h):d(g,c)<0)&&(f[c]=a)}),f}function Ja(a){for(var b=-1,c=Zc(a),d=c.length,e=fc(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Ka(a,b,c){var d={};if("function"!=typeof b)for(var e=-1,f=Y(arguments,!0,!1,1),g=Aa(a)?f.length:0;++e<g;){var h=f[e];h in a&&(d[h]=a[h])}else b=p.createCallback(b,c,3),ed(a,function(a,c,e){b(a,c,e)&&(d[c]=a)});return d}function La(a,b,c,d){var e=Xc(a);if(b=W(b,d,4),null==c)if(e)c=[];else{var f=a&&a.constructor,g=f&&f.prototype;c=ea(g)}return(e?Ta:fd)(a,function(a,d,e){return b(c,a,d,e)}),c}function Ma(a){for(var b=-1,c=Zc(a),d=c.length,e=fc(d);++b<d;)e[b]=a[c[b]];return e}function Na(a){for(var b=arguments,c=-1,d=Y(b,!0,!1,1),e=b[2]&&b[2][b[1]]===a?1:d.length,f=fc(e);++c<e;)f[c]=a[d[c]];return f}function Oa(a,b,c){var d=-1,e=ga(),f=a?a.length:0,g=!1;return c=(0>c?Nc(0,f+c):c)||0,Xc(a)?g=e(a,b,c)>-1:"number"==typeof f?g=(Fa(a)?a.indexOf(b,c):e(a,b,c))>-1:fd(a,function(a){return++d>=c?!(g=a===b):void 0}),g}function Pa(a,b,c){var d=!0;b=p.createCallback(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&(d=!!b(a[e],e,a)););else fd(a,function(a,c,e){return d=!!b(a,c,e)});return d}function Qa(a,b,c){var d=[];b=p.createCallback(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f;){var g=a[e];b(g,e,a)&&d.push(g)}else fd(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function Ra(a,b,c){b=p.createCallback(b,c,3);var d=-1,e=a?a.length:0;if("number"!=typeof e){var f;return fd(a,function(a,c,d){return b(a,c,d)?(f=a,!1):void 0}),f}for(;++d<e;){var g=a[d];if(b(g,d,a))return g}}function Sa(a,b,c){var d;return b=p.createCallback(b,c,3),Ua(a,function(a,c,e){return b(a,c,e)?(d=a,!1):void 0}),d}function Ta(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:W(b,c,3),"number"==typeof e)for(;++d<e&&b(a[d],d,a)!==!1;);else fd(a,b);return a}function Ua(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:W(b,c,3),"number"==typeof d)for(;d--&&b(a[d],d,a)!==!1;);else{var e=Zc(a);d=e.length,fd(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function Va(a,b){var c=Rc.call(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=fc("number"==typeof f?f:0);return Ta(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function Wa(a,b,c){var d=-1,e=a?a.length:0;if(b=p.createCallback(b,c,3),"number"==typeof e)for(var f=fc(e);++d<e;)f[d]=b(a[d],d,a);else f=[],fd(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function Xa(a,b,c){var e=-(1/0),f=e;if(!b&&Xc(a))for(var g=-1,h=a.length;++g<h;){var i=a[g];i>f&&(f=i)}else b=!b&&Fa(a)?d:p.createCallback(b,c,3),Ta(a,function(a,c,d){var g=b(a,c,d);g>e&&(e=g,f=a)});return f}function Ya(a,b,c){var e=1/0,f=e;if(!b&&Xc(a))for(var g=-1,h=a.length;++g<h;){var i=a[g];f>i&&(f=i)}else b=!b&&Fa(a)?d:p.createCallback(b,c,3),Ta(a,function(a,c,d){var g=b(a,c,d);e>g&&(e=g,f=a)});return f}function Za(a,b){var c=-1,d=a?a.length:0;if("number"==typeof d)for(var e=fc(d);++c<d;)e[c]=a[c][b];return e||Wa(a,b)}function $a(a,b,c,d){if(!a)return c;var e=arguments.length<3;b=W(b,d,4);var f=-1,g=a.length;if("number"==typeof g)for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a);else fd(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function _a(a,b,c,d){var e=arguments.length<3;return b=W(b,d,4),Ua(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)}),c}function ab(a,b,c){return b=p.createCallback(b,c,3),Qa(a,function(a,c,d){return!b(a,c,d)})}function bb(a,b,c){var d=a?a.length:0;if("number"!=typeof d&&(a=Ma(a)),null==b||c)return a?a[Wb(d-1)]:o;var e=cb(a);return e.length=Oc(Nc(0,b),e.length),e}function cb(a){var b=-1,c=a?a.length:0,d=fc("number"==typeof c?c:0);return Ta(a,function(a){var c=Wb(++b);d[b]=d[c],d[c]=a}),d}function db(a){var b=a?a.length:0;return"number"==typeof b?b:Zc(a).length}function eb(a,b,c){var d;b=p.createCallback(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&!(d=b(a[e],e,a)););else fd(a,function(a,c,e){return!(d=b(a,c,e))});return!!d}function fb(a,b,c){var d=-1,f=a?a.length:0,g=fc("number"==typeof f?f:0);for(b=p.createCallback(b,c,3),Ta(a,function(a,c,e){var f=g[++d]=i();f.criteria=b(a,c,e),f.index=d,f.value=a}),f=g.length,g.sort(e);f--;){var h=g[f];g[f]=h.value,l(h)}return g}function gb(a){return a&&"number"==typeof a.length?m(a):Ma(a)}function hb(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function ib(c){var d=-1,e=ga(),g=c?c.length:0,h=Y(arguments,!0,!0,1),i=[],j=g>=t&&e===a;if(j){var k=f(h);k?(e=b,h=k):j=!1}for(;++d<g;){var m=c[d];e(h,m)<0&&i.push(m)}return j&&l(h),i}function jb(a,b,c){var d=-1,e=a?a.length:0;for(b=p.createCallback(b,c,3);++d<e;)if(b(a[d],d,a))return d;return-1}function kb(a,b,c){var d=a?a.length:0;for(b=p.createCallback(b,c,3);d--;)if(b(a[d],d,a))return d;return-1}function lb(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=-1;for(b=p.createCallback(b,c,3);++f<e&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[0]:o;return m(a,0,Oc(Nc(0,d),e))}function mb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=d&&d[b]===a?null:b,b=!1),null!=c&&(a=Wa(a,c,d)),Y(a,b)}function nb(b,c,d){if("number"==typeof d){var e=b?b.length:0;d=0>d?Nc(0,e+d):d||0}else if(d){var f=wb(b,c);return b[f]===c?f:-1}return a(b,c,d)}function ob(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=p.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else d=null==b||c?1:b||d;return m(a,0,Oc(Nc(0,e-d),e))}function pb(c){for(var d=arguments,e=d.length,g=-1,i=h(),j=-1,m=ga(),n=c?c.length:0,o=[],p=h();++g<e;){var q=d[g];i[g]=m===a&&(q?q.length:0)>=t&&f(g?d[g]:p)}a:for(;++j<n;){var r=i[0];if(q=c[j],(r?b(r,q):m(p,q))<0){for(g=e,(r||p).push(q);--g;)if(r=i[g],(r?b(r,q):m(d[g],q))<0)continue a;o.push(q)}}for(;e--;)r=i[e],r&&l(r);return k(i),k(p),o}function qb(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=p.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[e-1]:o;return m(a,Nc(0,e-d))}function rb(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Nc(0,d+c):Oc(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function sb(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(Dc.call(a,f--,1),e--);return a}function tb(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Nc(0,tc((b-a)/(c||1))),f=fc(e);++d<e;)f[d]=a,a+=c;return f}function ub(a,b,c){var d=-1,e=a?a.length:0,f=[];for(b=p.createCallback(b,c,3);++d<e;){var g=a[d];b(g,d,a)&&(f.push(g),Dc.call(a,d--,1),e--)}return f}function vb(a,b,c){if("number"!=typeof b&&null!=b){var d=0,e=-1,f=a?a.length:0;for(b=p.createCallback(b,c,3);++e<f&&b(a[e],e,a);)d++}else d=null==b||c?1:Nc(0,b);return m(a,d)}function wb(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?p.createCallback(c,d,1):Tb,b=c(b);f>e;){var g=e+f>>>1;c(a[g])<b?e=g+1:f=g}return e}function xb(a){return ba(Y(arguments,!0,!0))}function yb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=d&&d[b]===a?null:b,b=!1),null!=c&&(c=p.createCallback(c,d,3)),ba(a,b,c)}function zb(a){return ib(a,Rc.call(arguments,1))}function Ab(){for(var a=arguments.length>1?arguments:arguments[0],b=-1,c=a?Xa(Za(a,"length")):0,d=fc(0>c?0:c);++b<c;)d[b]=Za(a,b);return d}function Bb(a,b){for(var c=-1,d=a?a.length:0,e={};++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Cb(a,b){if(!za(b))throw new oc;return function(){return--a<1?b.apply(this,arguments):void 0}}function Db(a,b){return arguments.length>2?da(a,17,Rc.call(arguments,2),null,b):da(a,1,null,null,b)}function Eb(a){for(var b=arguments.length>1?Y(arguments,!0,!1,1):qa(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=da(a[e],1,null,null,a)}return a}function Fb(a,b){return arguments.length>2?da(b,19,Rc.call(arguments,2),null,a):da(b,3,null,null,a)}function Gb(){for(var a=arguments,b=a.length;b--;)if(!za(a[b]))throw new oc;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function Hb(a,b,c){var d=typeof a;if(null==a||"function"==d)return W(a,b,c);if("object"!=d)return function(b){return b[a]};var e=Zc(a),f=e[0],g=a[f];return 1!=e.length||g!==g||Aa(g)?function(b){for(var c=e.length,d=!1;c--&&(d=Z(b[e[c]],a[e[c]],null,!0)););return d}:function(a){var b=a[f];return g===b&&(0!==g||1/g==1/b)}}function Ib(a,b){return b="number"==typeof b?b:+b||a.length,da(a,4,null,null,null,b)}function Jb(a,b,c){var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(!za(a))throw new oc;if(b=Nc(0,b)||0,c===!0){var n=!0;m=!1}else Aa(c)&&(n=c.leading,l="maxWait"in c&&(Nc(b,c.maxWait)||0),m="trailing"in c?c.trailing:m);var p=function(){var c=b-(zc()-g);if(0>=c){e&&uc(e);var l=j;e=i=j=o,l&&(k=zc(),f=a.apply(h,d))}else i=Cc(p,c)},q=function(){i&&uc(i),e=i=j=o,(m||l!==b)&&(k=zc(),f=a.apply(h,d))};return function(){if(d=arguments,g=zc(),h=this,j=m&&(i||!n),l===!1)var c=n&&!i;else{e||n||(k=g);var o=l-(g-k);0>=o?(e&&(e=uc(e)),k=g,f=a.apply(h,d)):e||(e=Cc(q,o))}return i||b===l||(i=Cc(p,b)),c&&(f=a.apply(h,d)),f}}function Kb(a){if(!za(a))throw new oc;var b=Rc.call(arguments,1);return Cc(function(){a.apply(o,b)},1)}function Lb(a,b){if(!za(a))throw new oc;var c=Rc.call(arguments,2);return Cc(function(){a.apply(o,c)},b)}function Mb(a,b){if(!za(a))throw new oc;var c=function(){var d=c.cache,e=b?b.apply(this,arguments):s+arguments[0];return yc.call(d,e)?d[e]:d[e]=a.apply(this,arguments)};return c.cache={},c}function Nb(a){var b,c;if(!za(a))throw new oc;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Ob(a){return da(a,16,Rc.call(arguments,1))}function Pb(a){return da(a,32,null,Rc.call(arguments,1))}function Qb(a,b,c){var d=!0,e=!0;if(!za(a))throw new oc;c===!1?d=!1:Aa(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),T.leading=d,T.maxWait=b,T.trailing=e;var f=Jb(a,b,T);return f}function Rb(a,b){if(!za(b))throw new oc;return function(){var c=[a];return Ac.apply(c,arguments),b.apply(this,c)}}function Sb(a){return null==a?"":nc(a).replace(bd,fa)}function Tb(a){return a}function Ub(a,b){var c=a,d=!b||za(c);b||(c=q,b=a,a=p),Ta(qa(b),function(e){var f=a[e]=b[e];d&&(c.prototype[e]=function(){var b=this.__wrapped__,d=[b];Ac.apply(d,arguments);var e=f.apply(a,d);return b&&"object"==typeof b&&b===e?this:(e=new c(e),e.__chain__=this.__chain__,e)})})}function Vb(){return c._=rc,this}function Wb(a,b,c){var d=null==a,e=null==b;null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0;var f=Qc();return c||a%1||b%1?Oc(a+f*(b-a+parseFloat("1e-"+((f+"").length-1))),b):a+vc(f*(b-a+1))}function Xb(a,b){if(a){var c=a[b];return za(c)?a[b]():c}}function Yb(a,b,c){var d=p.templateSettings;a||(a=""),c=dd({},c,d);var e,f=dd({},c.imports,d.imports),h=Zc(f),i=Ma(f),j=0,k=c.interpolate||E,l="__p += '",m=mc((c.escape||E).source+"|"+k.source+"|"+(k===C?z:E).source+"|"+(c.evaluate||E).source+"|$","g");a.replace(m,function(b,c,d,f,h,i){return d||(d=f),l+=a.slice(j,i).replace(G,g),c&&(l+="' +\n__e("+c+") +\n'"),h&&(e=!0,l+="';\n"+h+";\n__p += '"),d&&(l+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),j=i+b.length,b}),l+="';\n";var n=c.variable,q=n;q||(n="obj",l="with ("+n+") {\n"+l+"\n}\n"),l=(e?l.replace(w,""):l).replace(x,"$1").replace(y,"$1;"),l="function("+n+") {\n"+(q?"":n+" || ("+n+" = {});\n")+"var __t, __p = '', __e = _.escape"+(e?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var r="\n/*\n//# sourceURL="+(c.sourceURL||"/lodash/template/source["+I++ +"]")+"\n*/";try{var s=ic(h,"return "+l+r).apply(o,i)}catch(t){throw t.source=l,t}return b?s(b):(s.source=l,s)}function Zb(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=fc(a);for(b=W(b,c,1);++d<a;)e[d]=b(d);return e}function $b(a){return null==a?"":nc(a).replace(ad,ia)}function _b(a){var b=++r;return nc(null==a?"":a)+b}function ac(a){return a=new q(a),a.__chain__=!0,a}function bc(a,b){return b(a),a}function cc(){return this.__chain__=!0,this}function dc(){return nc(this.__wrapped__)}function ec(){return this.__wrapped__}c=c?aa.defaults(X.Object(),c,aa.pick(X,H)):X;var fc=c.Array,gc=c.Boolean,hc=c.Date,ic=c.Function,jc=c.Math,kc=c.Number,lc=c.Object,mc=c.RegExp,nc=c.String,oc=c.TypeError,pc=[],qc=lc.prototype,rc=c._,sc=mc("^"+nc(qc.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),tc=jc.ceil,uc=c.clearTimeout,vc=jc.floor,wc=ic.prototype.toString,xc=sc.test(xc=lc.getPrototypeOf)&&xc,yc=qc.hasOwnProperty,zc=sc.test(zc=hc.now)&&zc||function(){return+new hc},Ac=pc.push,Bc=c.setImmediate,Cc=c.setTimeout,Dc=pc.splice,Ec=qc.toString,Fc=pc.unshift,Gc=function(){try{var a={},b=sc.test(b=lc.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),Hc=sc.test(Hc=Ec.bind)&&Hc,Ic=sc.test(Ic=lc.create)&&Ic,Jc=sc.test(Jc=fc.isArray)&&Jc,Kc=c.isFinite,Lc=c.isNaN,Mc=sc.test(Mc=lc.keys)&&Mc,Nc=jc.max,Oc=jc.min,Pc=c.parseInt,Qc=jc.random,Rc=pc.slice,Sc=sc.test(c.attachEvent),Tc=Hc&&!/\n|true/.test(Hc+Sc),Uc={};Uc[K]=fc,Uc[L]=gc,Uc[M]=hc,Uc[N]=ic,Uc[P]=lc,Uc[O]=kc,Uc[Q]=mc,Uc[R]=nc,q.prototype=p.prototype;var Vc=p.support={};Vc.fastBind=Hc&&!Tc,Vc.funcDecomp=!sc.test(c.WinRTError)&&F.test(n),Vc.funcNames="string"==typeof ic.name,p.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:C,variable:"",imports:{_:p}},Ic||(ea=function(a){if(Aa(a)){j.prototype=a;var b=new j;j.prototype=null}return b||{}});var Wc=Gc?function(a,b){U.value=b,Gc(a,"__bindData__",U)}:j,Xc=Jc||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ec.call(a)==K||!1},Yc=function(a){var b,c=a,d=[];if(!c)return d;if(!V[typeof a])return d;for(b in c)yc.call(c,b)&&d.push(b);return d},Zc=Mc?function(a){return Aa(a)?Mc(a):[]}:Yc,$c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},_c=sa($c),ad=mc("("+Zc(_c).join("|")+")","g"),bd=mc("["+Zc($c).join("")+"]","g"),cd=function(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=W(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if(e=g[h],e&&V[typeof e])for(var k=-1,l=V[typeof e]&&Zc(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f},dd=function(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if(e=g[h],e&&V[typeof e])for(var j=-1,k=V[typeof e]&&Zc(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f},ed=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!V[typeof e])return f;b=b&&"undefined"==typeof c?b:W(b,c,3);for(d in e)if(b(e[d],d,a)===!1)return f;return f},fd=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!V[typeof e])return f;b=b&&"undefined"==typeof c?b:W(b,c,3);for(var g=-1,h=V[typeof e]&&Zc(e),i=h?h.length:0;++g<i;)if(d=h[g],b(e[d],d,a)===!1)return f;return f},gd=function(a){if(!a||Ec.call(a)!=P)return!1;var b=a.valueOf,c="function"==typeof b&&(c=xc(b))&&xc(c);return c?a==c||xc(a)==c:ha(a)},hd=ca(function(a,b,c){yc.call(a,c)?a[c]++:a[c]=1}),id=ca(function(a,b,c){(yc.call(a,c)?a[c]:a[c]=[]).push(b)}),jd=ca(function(a,b,c){a[c]=b}),kd=Qa;Tc&&$&&"function"==typeof Bc&&(Kb=function(a){if(!za(a))throw new oc;return Bc.apply(c,arguments)});var ld=8==Pc(v+"08")?Pc:function(a,b){return Pc(Fa(a)?a.replace(D,""):a,b||0)};return p.after=Cb,p.assign=cd,p.at=Na,p.bind=Db,p.bindAll=Eb,p.bindKey=Fb,p.chain=ac,p.compact=hb,p.compose=Gb,p.countBy=hd,p.createCallback=Hb,p.curry=Ib,p.debounce=Jb,p.defaults=dd,p.defer=Kb,p.delay=Lb,p.difference=ib,p.filter=Qa,p.flatten=mb,p.forEach=Ta,p.forEachRight=Ua,p.forIn=ed,p.forInRight=oa,p.forOwn=fd,p.forOwnRight=pa,p.functions=qa,p.groupBy=id,p.indexBy=jd,p.initial=ob,p.intersection=pb,p.invert=sa,p.invoke=Va,p.keys=Zc,p.map=Wa,p.max=Xa,p.memoize=Mb,p.merge=Ha,p.min=Ya,p.omit=Ia,p.once=Nb,p.pairs=Ja,p.partial=Ob,p.partialRight=Pb,p.pick=Ka,p.pluck=Za,p.pull=sb,p.range=tb,p.reject=ab,p.remove=ub,p.rest=vb,p.shuffle=cb,p.sortBy=fb,p.tap=bc,p.throttle=Qb,p.times=Zb,p.toArray=gb,p.transform=La,p.union=xb,p.uniq=yb,p.values=Ma,p.where=kd,p.without=zb,p.wrap=Rb,p.zip=Ab,p.zipObject=Bb,p.collect=Wa,p.drop=vb,p.each=Ta,p.eachRight=Ua,p.extend=cd,p.methods=qa,p.object=Bb,p.select=Qa,p.tail=vb,p.unique=yb,p.unzip=Ab,Ub(p),p.clone=ka,p.cloneDeep=la,p.contains=Oa,p.escape=Sb,p.every=Pa,p.find=Ra,p.findIndex=jb,p.findKey=ma,p.findLast=Sa,p.findLastIndex=kb,p.findLastKey=na,p.has=ra,p.identity=Tb,p.indexOf=nb,p.isArguments=ja,p.isArray=Xc,p.isBoolean=ta,p.isDate=ua,p.isElement=va,p.isEmpty=wa,p.isEqual=xa,p.isFinite=ya,p.isFunction=za,p.isNaN=Ba,p.isNull=Ca,p.isNumber=Da,p.isObject=Aa,p.isPlainObject=gd,p.isRegExp=Ea,p.isString=Fa,p.isUndefined=Ga,p.lastIndexOf=rb,p.mixin=Ub,p.noConflict=Vb,p.parseInt=ld,p.random=Wb,p.reduce=$a,p.reduceRight=_a,p.result=Xb,p.runInContext=n,p.size=db,p.some=eb,p.sortedIndex=wb,p.template=Yb,p.unescape=$b,p.uniqueId=_b,p.all=Pa,p.any=eb,p.detect=Ra,p.findWhere=Ra,p.foldl=$a,p.foldr=_a,p.include=Oa,p.inject=$a,fd(p,function(a,b){p.prototype[b]||(p.prototype[b]=function(){var b=[this.__wrapped__],c=this.__chain__;Ac.apply(b,arguments);var d=a.apply(p,b);return c?new q(d,c):d})}),p.first=lb,p.last=qb,p.sample=bb,p.take=lb,p.head=lb,fd(p,function(a,b){var c="sample"!==b;p.prototype[b]||(p.prototype[b]=function(b,d){var e=this.__chain__,f=a(this.__wrapped__,b,d);return e||null!=b&&(!d||c&&"function"==typeof b)?new q(f,e):f})}),p.VERSION="2.2.1",p.prototype.chain=cc,p.prototype.toString=dc,p.prototype.value=ec,p.prototype.valueOf=ec,Ta(["join","pop","shift"],function(a){var b=pc[a];p.prototype[a]=function(){var a=this.__chain__,c=b.apply(this.__wrapped__,arguments);return a?new q(c,a):c}}),Ta(["push","reverse","sort","unshift"],function(a){var b=pc[a];p.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Ta(["concat","slice","splice"],function(a){var b=pc[a];p.prototype[a]=function(){return new q(b.apply(this.__wrapped__,arguments),this.__chain__)}}),p}var o,p=[],q=[],r=0,s=+new Date+"",t=75,u=40,v=" 	\f \ufeff\n\r\u2028\u2029 ᠎             　",w=/\b__p \+= '';/g,x=/\b(__p \+=) '' \+/g,y=/(__e\(.*?\)|\b__t\)) \+\n'';/g,z=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,A=/\w*$/,B=/^function[ \n\r\t]+\w/,C=/<%=([\s\S]+?)%>/g,D=RegExp("^["+v+"]*0+(?=.$)"),E=/($^)/,F=/\bthis\b/,G=/['\n\r\t\u2028\u2029\\]/g,H=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],I=0,J="[object Arguments]",K="[object Array]",L="[object Boolean]",M="[object Date]",N="[object Function]",O="[object Number]",P="[object Object]",Q="[object RegExp]",R="[object String]",S={};S[N]=!1,S[J]=S[K]=S[L]=S[M]=S[O]=S[P]=S[Q]=S[R]=!0;var T={leading:!1,maxWait:0,trailing:!1},U={configurable:!1,enumerable:!1,value:null,writable:!1},V={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},W={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},X=V[typeof window]&&window||this,Y=V[typeof exports]&&exports&&!exports.nodeType&&exports,Z=V[typeof module]&&module&&!module.nodeType&&module,$=Z&&Z.exports===Y&&Y,_=V[typeof global]&&global;!_||_.global!==_&&_.window!==_||(X=_);var aa=n();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(X._=aa,define(function(){return aa})):Y&&Z?$?(Z.exports=aa)._=aa:Y._=aa:X._=aa}).call(this),function(a,b){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(c,d,e){a.Backbone=b(a,e,c,d)});else if("undefined"!=typeof exports){var c=require("underscore");b(a,exports,c)}else a.Backbone=b(a,{},a._,a.jQuery||a.Zepto||a.ender||a.$)}(this,function(a,b,c,d){{var e=a.Backbone,f=[],g=(f.push,f.slice);f.splice}b.VERSION="1.1.2",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var h=b.Events={on:function(a,b,c){if(!j(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,d){if(!j(this,"once",a,[b,d])||!b)return this;var e=this,f=c.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,d)},off:function(a,b,d){var e,f,g,h,i,k,l,m;if(!this._events||!j(this,"off",a,[b,d]))return this;if(!a&&!b&&!d)return this._events=void 0,this;for(h=a?[a]:c.keys(this._events),i=0,k=h.length;k>i;i++)if(a=h[i],g=this._events[a]){if(this._events[a]=e=[],b||d)for(l=0,m=g.length;m>l;l++)f=g[l],(b&&b!==f.callback&&b!==f.callback._callback||d&&d!==f.context)&&e.push(f);e.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=g.call(arguments,1);if(!j(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&k(c,b),d&&k(d,arguments),this},stopListening:function(a,b,d){var e=this._listeningTo;if(!e)return this;var f=!b&&!d;d||"object"!=typeof b||(d=this),a&&((e={})[a._listenId]=a);for(var g in e)a=e[g],a.off(b,d,this),(f||c.isEmpty(a._events))&&delete this._listeningTo[g];return this}},i=/\s+/,j=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(i.test(c)){for(var f=c.split(i),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},k=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},l={listenTo:"on",listenToOnce:"once"};c.each(l,function(a,b){h[b]=function(b,d,e){var f=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=c.uniqueId("l"));return f[g]=b,e||"object"!=typeof d||(e=this),b[a](d,e,this),this}}),h.bind=h.on,h.unbind=h.off,c.extend(b,h);var m=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(m.prototype,h,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,d){var e,f,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(f=a,d=b):(f={})[a]=b,d||(d={}),!this._validate(f,d))return!1;g=d.unset,i=d.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=c.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in f&&(this.id=f[this.idAttribute]);for(e in f)b=f[e],c.isEqual(l[e],b)||h.push(e),c.isEqual(k[e],b)?delete this.changed[e]:this.changed[e]=b,g?delete l[e]:l[e]=b;if(!i){h.length&&(this._pending=d);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],d)}if(j)return this;if(!i)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var b,d=!1,e=this._changing?this._previousAttributes:this.attributes;for(var f in a)c.isEqual(e[f],b=a[f])||((d||(d={}))[f]=b);return d},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null;

},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,d=a.success;return a.success=function(c){return b.set(b.parse(c,a),a)?(d&&d(b,c,a),void b.trigger("sync",b,c,a)):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,d){var e,f,g,h=this.attributes;if(null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0},d),e&&!d.wait){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;e&&d.wait&&(this.attributes=c.extend({},h,e)),void 0===d.parse&&(d.parse=!0);var i=this,j=d.success;return d.success=function(a){i.attributes=h;var b=i.parse(a,d);return d.wait&&(b=c.extend(e||{},b)),c.isObject(b)&&!i.set(b,d)?!1:(j&&j(i,a,d),void i.trigger("sync",i,a,d))},L(this,d),f=this.isNew()?"create":d.patch?"patch":"update","patch"===f&&(d.attrs=e),g=this.sync(f,this,d),e&&d.wait&&(this.attributes=h),g},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(c){(a.wait||b.isNew())&&e(),d&&d(b,c,a),b.isNew()||b.trigger("sync",b,c,a)},this.isNew())return a.success(),!1;L(this,a);var f=this.sync("delete",this,a);return a.wait||e(),f},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||K();return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return d?(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1):!0}});var n=["keys","values","pairs","invert","pick","omit"];c.each(n,function(a){m.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.attributes),c[a].apply(c,b)}});var o=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))},p={add:!0,remove:!0,merge:!0},q={add:!0,remove:!1};c.extend(o.prototype,h,{model:m,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,q))},remove:function(a,b){var d=!c.isArray(a);a=d?[a]:c.clone(a),b||(b={});var e,f,g,h;for(e=0,f=a.length;f>e;e++)h=a[e]=this.get(a[e]),h&&(delete this._byId[h.id],delete this._byId[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,b.silent||(b.index=g,h.trigger("remove",h,this,b)),this._removeReference(h,b));return d?a[0]:a},set:function(a,b){b=c.defaults({},b,p),b.parse&&(a=this.parse(a,b));var d=!c.isArray(a);a=d?a?[a]:[]:c.clone(a);var e,f,g,h,i,j,k,l=b.at,n=this.model,o=this.comparator&&null==l&&b.sort!==!1,q=c.isString(this.comparator)?this.comparator:null,r=[],s=[],t={},u=b.add,v=b.merge,w=b.remove,x=!o&&u&&w?[]:!1;for(e=0,f=a.length;f>e;e++){if(i=a[e]||{},g=i instanceof m?h=i:i[n.prototype.idAttribute||"id"],j=this.get(g))w&&(t[j.cid]=!0),v&&(i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b)),j.set(i,b),o&&!k&&j.hasChanged(q)&&(k=!0)),a[e]=j;else if(u){if(h=a[e]=this._prepareModel(i,b),!h)continue;r.push(h),this._addReference(h,b)}h=j||h,!x||!h.isNew()&&t[h.id]||x.push(h),t[h.id]=!0}if(w){for(e=0,f=this.length;f>e;++e)t[(h=this.models[e]).cid]||s.push(h);s.length&&this.remove(s,b)}if(r.length||x&&x.length)if(o&&(k=!0),this.length+=r.length,null!=l)for(e=0,f=r.length;f>e;e++)this.models.splice(l+e,0,r[e]);else{x&&(this.models.length=0);var y=x||r;for(e=0,f=y.length;f>e;e++)this.models.push(y[e])}if(k&&this.sort({silent:!0}),!b.silent){for(e=0,f=r.length;f>e;e++)(h=r[e]).trigger("add",h,this,b);(k||x&&x.length)&&this.trigger("sort",this,b)}return d?a[0]:a},reset:function(a,b){b||(b={});for(var d=0,e=this.models.length;e>d;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return g.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,b){return c.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),c.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b(d,c,a),d.trigger("sync",d,c,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?c.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var d=this,e=b.success;return b.success=function(a,c){b.wait&&d.add(a,b),e&&e(a,c,b)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof m)return a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_addReference:function(a,b){this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a),a.collection||(a.collection=this),a.on("all",this._onModelEvent,this)},_removeReference:function(a,b){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var r=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];c.each(r,function(a){o.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.models),c[a].apply(c,b)}});var s=["groupBy","countBy","sortBy","indexBy"];c.each(s,function(a){o.prototype[a]=function(b,d){var e=c.isFunction(b)?b:function(a){return a.get(b)};return c[a](this.models,e,d)}});var t=b.View=function(a){this.cid=c.uniqueId("view"),a||(a={}),c.extend(this,c.pick(a,v)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},u=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName","events"];c.extend(t.prototype,h,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,c){return this.$el&&this.undelegateEvents(),this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=c.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[a[b]]),d){var e=b.match(u),f=e[1],g=e[2];d=c.bind(d,this),f+=".delegateEvents"+this.cid,""===g?this.$el.on(f,d):this.$el.on(f,g,d)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"),!1);else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className"));var d=b.$("<"+c.result(this,"tagName")+">").attr(a);this.setElement(d,!1)}}}),b.sync=function(a,d,e){var f=x[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||K()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",f),h?h.apply(this,arguments):void 0}}"GET"===g.type||e.emulateJSON||(g.processData=!1),"PATCH"===g.type&&w&&(g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,i,e),i};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var y=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},z=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,B=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(y.prototype,h,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g),f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g)}),this},execute:function(a,b){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(C,"\\$&").replace(z,"(?:$1)?").replace(A,function(a,b){return b?a:"([^/?]+)"}).replace(B,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var D=b.History=function(){this.handlers=[],c.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},E=/^[#\/]|\s+$/g,F=/^\/+|\/+$/g,G=/msie [\w.]+/,H=/\/$/,I=/#.*$/;D.started=!1,c.extend(D.prototype,h,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search);var c=this.root.replace(H,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(E,"")},start:function(a){if(D.started)throw new Error("Backbone.history has already been started");D.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var d=this.getFragment(),e=document.documentMode,f=G.exec(navigator.userAgent.toLowerCase())&&(!e||7>=e);if(this.root=("/"+this.root+"/").replace(F,"/"),f&&this._wantsHashChange){var g=b.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=g.hide().appendTo("body")[0].contentWindow,this.navigate(d)}this._hasPushState?b.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!f?b.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=d;var h=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&h.hash&&(this.fragment=this.getHash().replace(E,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){b.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),D.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b===this.fragment?!1:(this.iframe&&this.navigate(b),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),c.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!D.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(I,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new D;var J=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};m.extend=o.extend=y.extend=t.extend=D.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}};return b}),function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.g=b()}(this,function(){function a(b,c){if(!(this instanceof a))return new a(b,c);var d;void 0===c&&Object(b)!==b?(d=b.split(-1===b.indexOf("@")?" ":"@"),this.x=parseInt(d[0],10),this.y=parseInt(d[1],10)):Object(b)===b?(this.x=b.x,this.y=b.y):(this.x=b,this.y=c)}function b(c,d){return this instanceof b?(this.start=a(c),void(this.end=a(d))):new b(c,d)}function c(a,b,d,e){return this instanceof c?(void 0===b&&(b=a.y,d=a.width,e=a.height,a=a.x),this.x=a,this.y=b,this.width=d,void(this.height=e)):new c(a,b,d,e)}function d(b,c,e){return this instanceof d?(b=a(b),this.x=b.x,this.y=b.y,this.a=c,void(this.b=e)):new d(b,c,e)}var e=Math,f=e.abs,g=e.cos,h=e.sin,i=e.sqrt,j=e.min,k=e.max,l=(e.atan,e.atan2),m=(e.acos,e.round),n=e.floor,o=e.PI,p=e.random,q=function(a){return 180*a/o%360},r=function(a,b){return b=b||!1,a=b?a:a%360,a*o/180},s=function(a,b){return b*Math.round(a/b)},t=function(a){return a%360+(0>a?360:0)};a.prototype={toString:function(){return this.x+"@"+this.y},adhereToRect:function(a){return a.containsPoint(this)?this:(this.x=j(k(this.x,a.x),a.x+a.width),this.y=j(k(this.y,a.y),a.y+a.height),this)},theta:function(b){b=a(b);var c=-(b.y-this.y),d=b.x-this.x,e=10,f=0==c.toFixed(e)&&0==d.toFixed(e)?0:l(c,d);return 0>f&&(f=2*o+f),180*f/o},distance:function(a){return b(this,a).length()},manhattanDistance:function(a){return f(a.x-this.x)+f(a.y-this.y)},offset:function(a,b){return this.x+=a||0,this.y+=b||0,this},magnitude:function(){return i(this.x*this.x+this.y*this.y)||.01},update:function(a,b){return this.x=a||0,this.y=b||0,this},round:function(a){return this.x=a?this.x.toFixed(a):m(this.x),this.y=a?this.y.toFixed(a):m(this.y),this},normalize:function(a){var b=(a||1)/this.magnitude();return this.x=b*this.x,this.y=b*this.y,this},difference:function(b){return a(this.x-b.x,this.y-b.y)},bearing:function(a){return b(this,a).bearing()},toPolar:function(b){b=b&&a(b)||a(0,0);var c=this.x,d=this.y;return this.x=i((c-b.x)*(c-b.x)+(d-b.y)*(d-b.y)),this.y=r(b.theta(a(c,d))),this},rotate:function(b,c){c=(c+360)%360,this.toPolar(b),this.y+=r(c);var d=a.fromPolar(this.x,this.y,b);return this.x=d.x,this.y=d.y,this},move:function(b,c){var d=r(a(b).theta(this));return this.offset(g(d)*c,-h(d)*c)},changeInAngle:function(b,c,d){return a(this).offset(-b,-c).theta(d)-this.theta(d)},equals:function(a){return this.x===a.x&&this.y===a.y},snapToGrid:function(a,b){return this.x=s(this.x,a),this.y=s(this.y,b||a),this},reflection:function(b){return a(b).move(this,this.distance(b))}},a.fromPolar=function(b,c,d){d=d&&a(d)||a(0,0);var e=f(b*g(c)),i=f(b*h(c)),j=t(q(c));return 90>j?i=-i:180>j?(e=-e,i=-i):270>j&&(e=-e),a(d.x+e,d.y+i)},a.random=function(b,c,d,e){return a(n(p()*(c-b+1)+b),n(p()*(e-d+1)+d))},b.prototype={toString:function(){return this.start.toString()+" "+this.end.toString()},length:function(){return i(this.squaredLength())},squaredLength:function(){var a=this.start.x,b=this.start.y,c=this.end.x,d=this.end.y;return(a-=c)*a+(b-=d)*b},midpoint:function(){return a((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},intersection:function(b){var c=a(this.end.x-this.start.x,this.end.y-this.start.y),d=a(b.end.x-b.start.x,b.end.y-b.start.y),e=c.x*d.y-c.y*d.x,f=a(b.start.x-this.start.x,b.start.y-this.start.y),g=f.x*d.y-f.y*d.x,h=f.x*c.y-f.y*c.x;if(0===e||0>g*e||0>h*e)return null;if(e>0){if(g>e||h>e)return null}else if(e>g||e>h)return null;return a(this.start.x+g*c.x/e,this.start.y+g*c.y/e)},bearing:function(){var a=r(this.start.y),b=r(this.end.y),c=this.start.x,d=this.end.x,e=r(d-c),f=h(e)*g(b),i=g(a)*h(b)-h(a)*g(b)*g(e),j=q(l(f,i)),k=["NE","E","SE","S","SW","W","NW","N"],m=j-22.5;return 0>m&&(m+=360),m=parseInt(m/45),k[m]},pointAt:function(b){var c=(1-b)*this.start.x+b*this.end.x,d=(1-b)*this.start.y+b*this.end.y;return a(c,d)}},c.prototype={toString:function(){return this.origin().toString()+" "+this.corner().toString()},origin:function(){return a(this.x,this.y)},corner:function(){return a(this.x+this.width,this.y+this.height)},topRight:function(){return a(this.x+this.width,this.y)},bottomLeft:function(){return a(this.x,this.y+this.height)},center:function(){return a(this.x+this.width/2,this.y+this.height/2)},intersect:function(a){var b=this.origin(),c=this.corner(),d=a.origin(),e=a.corner();return e.x<=b.x||e.y<=b.y||d.x>=c.x||d.y>=c.y?!1:!0},sideNearestToPoint:function(b){b=a(b);var c=b.x-this.x,d=this.x+this.width-b.x,e=b.y-this.y,f=this.y+this.height-b.y,g=c,h="left";return g>d&&(g=d,h="right"),g>e&&(g=e,h="top"),g>f&&(g=f,h="bottom"),h},containsPoint:function(b){return b=a(b),b.x>=this.x&&b.x<=this.x+this.width&&b.y>=this.y&&b.y<=this.y+this.height?!0:!1},containsRect:function(a){var b=c(a).normalize(),d=b.width,e=b.height,f=b.x,g=b.y,h=this.width,i=this.height;if(0>(h|i|d|e))return!1;var j=this.x,k=this.y;if(j>f||k>g)return!1;if(h+=j,d+=f,f>=d){if(h>=j||d>h)return!1}else if(h>=j&&d>h)return!1;if(i+=k,e+=g,g>=e){if(i>=k||e>i)return!1}else if(i>=k&&e>i)return!1;return!0},pointNearestToPoint:function(b){if(b=a(b),this.containsPoint(b)){var c=this.sideNearestToPoint(b);switch(c){case"right":return a(this.x+this.width,b.y);case"left":return a(this.x,b.y);case"bottom":return a(b.x,this.y+this.height);case"top":return a(b.x,this.y)}}return b.adhereToRect(this)},intersectionWithLineFromCenterToPoint:function(c,d){c=a(c);var e,f=a(this.x+this.width/2,this.y+this.height/2);d&&c.rotate(f,d);for(var g=[b(this.origin(),this.topRight()),b(this.topRight(),this.corner()),b(this.corner(),this.bottomLeft()),b(this.bottomLeft(),this.origin())],h=b(f,c),i=g.length-1;i>=0;--i){var j=g[i].intersection(h);if(null!==j){e=j;break}}return e&&d&&e.rotate(f,-d),e},moveAndExpand:function(a){return this.x+=a.x,this.y+=a.y,this.width+=a.width,this.height+=a.height,this},round:function(a){return this.x=a?this.x.toFixed(a):m(this.x),this.y=a?this.y.toFixed(a):m(this.y),this.width=a?this.width.toFixed(a):m(this.width),this.height=a?this.height.toFixed(a):m(this.height),this},normalize:function(){var a=this.x,b=this.y,c=this.width,d=this.height;return this.width<0&&(a=this.x+this.width,c=-this.width),this.height<0&&(b=this.y+this.height,d=-this.height),this.x=a,this.y=b,this.width=c,this.height=d,this},bbox:function(a){var b=r(a||0),d=f(h(b)),e=f(g(b)),i=this.width*e+this.height*d,j=this.width*d+this.height*e;return c(this.x+(this.width-i)/2,this.y+(this.height-j)/2,i,j)}},d.prototype={toString:function(){return a(this.x,this.y).toString()+" "+this.a+" "+this.b},bbox:function(){return c(this.x-this.a,this.y-this.b,2*this.a,2*this.b)},intersectionWithLineFromCenterToPoint:function(b,c){b=a(b),c&&b.rotate(a(this.x,this.y),c);var d,e=b.x-this.x,f=b.y-this.y;if(0===e)return d=this.bbox().pointNearestToPoint(b),c?d.rotate(a(this.x,this.y),-c):d;var g=f/e,h=g*g,j=this.a*this.a,k=this.b*this.b,l=i(1/(1/j+h/k));l=0>e?-l:l;var m=g*l;return d=a(this.x+l,this.y+m),c?d.rotate(a(this.x,this.y),-c):d}};var u={curveThroughPoints:function(a){for(var b=this.getCurveControlPoints(a),c=["M",a[0].x,a[0].y],d=0;d<b[0].length;d++)c.push("C",b[0][d].x,b[0][d].y,b[1][d].x,b[1][d].y,a[d+1].x,a[d+1].y);return c},getCurveControlPoints:function(b){var c,d=[],e=[],f=b.length-1;if(1==f)return d[0]=a((2*b[0].x+b[1].x)/3,(2*b[0].y+b[1].y)/3),e[0]=a(2*d[0].x-b[0].x,2*d[0].y-b[0].y),[d,e];var g=[];for(c=1;f-1>c;c++)g[c]=4*b[c].x+2*b[c+1].x;g[0]=b[0].x+2*b[1].x,g[f-1]=(8*b[f-1].x+b[f].x)/2;var h=this.getFirstControlPoints(g);for(c=1;f-1>c;++c)g[c]=4*b[c].y+2*b[c+1].y;g[0]=b[0].y+2*b[1].y,g[f-1]=(8*b[f-1].y+b[f].y)/2;var i=this.getFirstControlPoints(g);for(c=0;f>c;c++)d.push(a(h[c],i[c])),e.push(f-1>c?a(2*b[c+1].x-h[c+1],2*b[c+1].y-i[c+1]):a((b[f].x+h[f-1])/2,(b[f].y+i[f-1])/2));return[d,e]},getFirstControlPoints:function(a){var b=a.length,c=[],d=[],e=2;c[0]=a[0]/e;for(var f=1;b>f;f++)d[f]=1/e,e=(b-1>f?4:3.5)-d[f],c[f]=(a[f]-c[f-1])/e;for(f=1;b>f;f++)c[b-f-1]-=d[b-f]*c[b-f];return c},getInversionSolver:function(a,b,c,d){function e(a,b){var c=f[a],d=f[b];return function(e){var f=(a%3?3:1)*(b%3?3:1),g=e.x*(c.y-d.y)+e.y*(d.x-c.x)+c.x*d.y-c.y*d.x;return f*g}}var f=arguments;return function(c){var d=3*e(2,3)(b),f=e(1,3)(a)/d,g=-e(2,3)(a)/d,h=f*e(3,1)(c)+g*(e(3,0)(c)+e(2,1)(c))+e(2,0)(c),i=f*e(3,0)(c)+g*e(2,0)(c)+e(1,0)(c);return i/(i-h)}},getCurveDivider:function(a,c,d,e){return function(f){var g=b(a,c).pointAt(f),h=b(c,d).pointAt(f),i=b(d,e).pointAt(f),j=b(g,h).pointAt(f),k=b(h,i).pointAt(f),l=b(j,k).pointAt(f);return[{p0:a,p1:g,p2:j,p3:l},{p0:l,p1:k,p2:i,p3:e}]}}},v={linear:function(a,b,c){var d=a[1]-a[0],e=b[1]-b[0];return(c-a[0])/d*e+b[0]||0}};return{toDeg:q,toRad:r,snapToGrid:s,normalizeAngle:t,point:a,line:b,rect:c,ellipse:d,bezier:u,scale:v}}),function(a,b){if("function"==typeof define&&define.amd)define(["Geometry"],b);else if("object"==typeof exports){var c=require("G")||require("Geometry")||require("g");module.exports=b(c)}else{var c=a.G||a.Geometry||a.g;a.Vectorizer=a.V=b(c)}}(this,function(a){function b(){var a=++m+"";return"v-"+a}function c(a){var b='<svg xmlns="'+k.xmlns+'" xmlns:xlink="'+k.xlink+'" version="'+l+'">'+(a||"")+"</svg>",c=new DOMParser;return c.async=!1,c.parseFromString(b,"text/xml").documentElement}function d(a,b,d){if(!a)return void 0;if("object"==typeof a)return new i(a);if(b=b||{},"svg"===a.toLowerCase())return new i(c());if("<"===a[0]){var f=c(a);if(f.childNodes.length>1){for(var g=[],h=0,j=f.childNodes.length;j>h;h++){var l=f.childNodes[h];g.push(new i(document.importNode(l,!0)))}return g}return new i(document.importNode(f.firstChild,!0))}a=document.createElementNS(k.xmlns,a);for(var m in b)e(a,m,b[m]);"[object Array]"!=Object.prototype.toString.call(d)&&(d=[d]);for(var n,h=0,j=d[0]&&d.length||0;j>h;h++)n=d[h],a.appendChild(n instanceof i?n.node:n);return new i(a)}function e(a,b,c){if(b.indexOf(":")>-1){var d=b.split(":");a.setAttributeNS(k[d[0]],d[1],c)}else"id"===b?a.id=c:a.setAttribute(b,c)}function f(a){var b,c,d;if(a){var e=/[ ,]+/,f=a.match(/translate\((.*)\)/);f&&(b=f[1].split(e));var g=a.match(/rotate\((.*)\)/);g&&(c=g[1].split(e));var h=a.match(/scale\((.*)\)/);h&&(d=h[1].split(e))}var i=d&&d[0]?parseFloat(d[0]):1;return{translate:{tx:b&&b[0]?parseInt(b[0],10):0,ty:b&&b[1]?parseInt(b[1],10):0},rotate:{angle:c&&c[0]?parseInt(c[0],10):0,cx:c&&c[1]?parseInt(c[1],10):void 0,cy:c&&c[2]?parseInt(c[2],10):void 0},scale:{sx:i,sy:d&&d[1]?parseFloat(d[1]):i}}}function g(a,b){var c=b.x*a.a+b.y*a.c+0,d=b.x*a.b+b.y*a.d+0;return{x:c,y:d}}function h(a){var b=g(a,{x:0,y:1}),c=g(a,{x:1,y:0}),d=180/Math.PI*Math.atan2(b.y,b.x)-90,e=180/Math.PI*Math.atan2(c.y,c.x);return{translateX:a.e,translateY:a.f,scaleX:Math.sqrt(a.a*a.a+a.b*a.b),scaleY:Math.sqrt(a.c*a.c+a.d*a.d),skewX:d,skewY:e,rotation:d}}function i(a){this.node=a,this.node.id||(this.node.id=b())}function j(a){var b=a.rx||a["top-rx"]||0,c=a.rx||a["bottom-rx"]||0,d=a.ry||a["top-ry"]||0,e=a.ry||a["bottom-ry"]||0;return["M",a.x,a.y+d,"v",a.height-d-e,"a",c,e,0,0,0,c,e,"h",a.width-2*c,"a",c,e,0,0,0,c,-e,"v",-(a.height-e-d),"a",b,d,0,0,0,-b,-d,"h",-(a.width-2*b),"a",b,d,0,0,0,-b,d].join(" ")}var k=(!(!window.SVGAngle&&!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")),{xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"}),l="1.1",m=0;i.prototype={translate:function(a,b,c){c=c||{},b=b||0;var d=this.attr("transform")||"",e=f(d);if("undefined"==typeof a)return e.translate;d=d.replace(/translate\([^\)]*\)/g,"").trim();var g=c.absolute?a:e.translate.tx+a,h=c.absolute?b:e.translate.ty+b,i="translate("+g+","+h+")";return this.attr("transform",(i+" "+d).trim()),this},rotate:function(a,b,c,d){d=d||{};var e=this.attr("transform")||"",g=f(e);if("undefined"==typeof a)return g.rotate;e=e.replace(/rotate\([^\)]*\)/g,"").trim(),a%=360;var h=d.absolute?a:g.rotate.angle+a,i=void 0!==b&&void 0!==c?","+b+","+c:"",j="rotate("+h+i+")";return this.attr("transform",(e+" "+j).trim()),this},scale:function(a,b){b="undefined"==typeof b?a:b;var c=this.attr("transform")||"",d=f(c);if("undefined"==typeof a)return d.scale;c=c.replace(/scale\([^\)]*\)/g,"").trim();var e="scale("+a+","+b+")";return this.attr("transform",(c+" "+e).trim()),this},bbox:function(a,b){if(!this.node.ownerSVGElement)return{x:0,y:0,width:0,height:0};var c;try{c=this.node.getBBox(),c={x:0|c.x,y:0|c.y,width:0|c.width,height:0|c.height}}catch(d){c={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}if(a)return c;var e=this.node.getTransformToElement(b||this.node.ownerSVGElement);return n.transformRect(c,e)},text:function(a,b){b=b||{};var c,e=a.split("\n"),f=0;this.attr("y","0.8em"),this.attr("display",a?null:"none"),this.node.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.node.textContent="";var g=this.node;if(b.textPath){var h=this.find("defs");0===h.length&&(h=d("defs"),this.append(h));var i=Object(b.textPath)===b.textPath?b.textPath.d:b.textPath;if(i){var j=d("path",{d:i});h.append(j)}var k=d("textPath");!b.textPath["xlink:href"]&&j&&k.attr("xlink:href","#"+j.node.id),Object(b.textPath)===b.textPath&&k.attr(b.textPath),this.append(k),g=k.node}if(1===e.length)return g.textContent=a,this;for(;f<e.length;f++)c=n("tspan",{dy:0==f?"0em":b.lineHeight||"1em",x:this.attr("x")||0}),c.addClass("line"),e[f]||c.addClass("empty-line"),c.node.textContent=e[f]||" ",n(g).append(c);return this},attr:function(a,b){if("string"==typeof a&&"undefined"==typeof b)return this.node.getAttribute(a);if("object"==typeof a)for(var c in a)a.hasOwnProperty(c)&&e(this.node,c,a[c]);else e(this.node,a,b);return this},remove:function(){this.node.parentNode&&this.node.parentNode.removeChild(this.node)},append:function(a){var b=a;"[object Array]"!==Object.prototype.toString.call(a)&&(b=[a]);for(var c=0,d=b.length;d>c;c++)a=b[c],this.node.appendChild(a instanceof i?a.node:a);return this},prepend:function(a){this.node.insertBefore(a instanceof i?a.node:a,this.node.firstChild)},svg:function(){return this.node instanceof window.SVGSVGElement?this:n(this.node.ownerSVGElement)},defs:function(){var a=this.svg().node.getElementsByTagName("defs");return a&&a.length?n(a[0]):void 0},clone:function(){var a=n(this.node.cloneNode(!0));return a.node.id=b(),a},findOne:function(a){var b=this.node.querySelector(a);return b?n(b):void 0},find:function(a){for(var b=this.node.querySelectorAll(a),c=0,d=b.length;d>c;c++)b[c]=n(b[c]);return b},toLocalPoint:function(a,b){var c=this.svg().node,d=c.createSVGPoint();d.x=a,d.y=b;try{var e=d.matrixTransform(c.getScreenCTM().inverse()),f=this.node.getTransformToElement(c).inverse()}catch(g){return d}return e.matrixTransform(f)},translateCenterToPoint:function(b){var c=this.bbox(),d=a.rect(c).center();this.translate(b.x-d.x,b.y-d.y)},translateAndAutoOrient:function(b,c,d){var e=this.scale();this.attr("transform",""),this.scale(e.sx,e.sy);var f=this.svg().node,g=this.bbox(!1,d),i=f.createSVGTransform();i.setTranslate(-g.x-g.width/2,-g.y-g.height/2);var j=f.createSVGTransform(),k=a.point(b).changeInAngle(b.x-c.x,b.y-c.y,c);j.setRotate(k,0,0);var l=f.createSVGTransform(),m=a.point(b).move(c,g.width/2);l.setTranslate(b.x+(b.x-m.x),b.y+(b.y-m.y));var n=this.node.getTransformToElement(d),o=f.createSVGTransform();o.setMatrix(l.matrix.multiply(j.matrix.multiply(i.matrix.multiply(n))));var p=h(o.matrix);return this.translate(p.translateX,p.translateY),this.rotate(p.rotation),this},animateAlongPath:function(a,b){var c=n("animateMotion",a),d=n("mpath",{"xlink:href":"#"+n(b).node.id});c.append(d),this.append(c);try{c.node.beginElement()}catch(e){if("fake"===document.documentElement.getAttribute("smiling")){var f=c.node;f.animators=[];var g=f.getAttribute("id");g&&(id2anim[g]=f);for(var h=getTargets(f),i=0,j=h.length;j>i;i++){var k=h[i],l=new Animator(f,k,i);animators.push(l),f.animators[i]=l,l.register()}}}},hasClass:function(a){return new RegExp("(\\s|^)"+a+"(\\s|$)").test(this.node.getAttribute("class"))},addClass:function(a){if(!this.hasClass(a)){var b=this.node.getAttribute("class")||"";this.node.setAttribute("class",(b+" "+a).trim())}return this},removeClass:function(a){if(this.hasClass(a)){var b=this.node.getAttribute("class").replace(new RegExp("(\\s|^)"+a+"(\\s|$)","g"),"$2");this.node.setAttribute("class",b)}return this},toggleClass:function(a,b){var c="undefined"==typeof b?this.hasClass(a):!b;return c?this.removeClass(a):this.addClass(a),this}};var n=d;n.decomposeMatrix=h,n.rectToPath=j;var o=n("svg").node;return n.createSVGMatrix=function(a){var b=o.createSVGMatrix();for(var c in a)b[c]=a[c];return b},n.createSVGTransform=function(){return o.createSVGTransform()},n.createSVGPoint=function(a,b){var c=o.createSVGPoint();return c.x=a,c.y=b,c},n.transformRect=function(a,b){var c=o.createSVGPoint();c.x=a.x,c.y=a.y;var d=c.matrixTransform(b);c.x=a.x+a.width,c.y=a.y;var e=c.matrixTransform(b);c.x=a.x+a.width,c.y=a.y+a.height;var f=c.matrixTransform(b);c.x=a.x,c.y=a.y+a.height;var g=c.matrixTransform(b),h=Math.min(d.x,e.x,f.x,g.x),i=Math.max(d.x,e.x,f.x,g.x),j=Math.min(d.y,e.y,f.y,g.y),k=Math.max(d.y,e.y,f.y,g.y);return{x:h,y:j,width:i-h,height:k-j}},n}),function(a,b){if("function"==typeof define&&define.amd)define(["lodash","Backbone","Vectorizer","Geometry","jQuery"],b);else if("object"==typeof exports){var c=require("$")||require("jQuery"),d=require("Backbone"),e=require("lodash"),f=require("V")||require("Vectorizer"),g=require("G")||require("Geometry")||require("g");

exports.joint=b(e,d,f,g,c)}else{var c=a.$||a.jQuery,d=a.Backbone,e=a._,f=a.V||a.Vectorizer,g=a.G||a.Geometry||a.g;a.joint=b(e,d,f,g,c)}}(this,function(a,b,c,d,e){var f={version:"0.9.3",dia:{},ui:{},layout:{},shapes:{},format:{},connectors:{},routers:{},util:{hashCode:function(a){var b=0;if(0==a.length)return b;for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);b=(b<<5)-b+d,b&=b}return b},getByPath:function(a,b,c){c=c||".";for(var d,e=b.split(c);e.length;){if(d=e.shift(),!(Object(a)===a&&d in a))return void 0;a=a[d]}return a},setByPath:function(a,b,c,d){d=d||".";var e=b.split(d),f=a,g=0;if(b.indexOf(d)>-1){for(var h=e.length;h-1>g;g++)f=f[e[g]]||(f[e[g]]={});f[e[h-1]]=c}else a[b]=c;return a},unsetByPath:function(a,b,c){c=c||".";var d=b.lastIndexOf(c);if(d>-1){var e=f.util.getByPath(a,b.substr(0,d),c);e&&delete e[b.slice(d+1)]}else delete a[b];return a},flattenObject:function(a,b,c){b=b||".";var d={};for(var e in a)if(a.hasOwnProperty(e)){var f="object"==typeof a[e];if(f&&c&&c(a[e])&&(f=!1),f){var g=this.flattenObject(a[e],b,c);for(var h in g)g.hasOwnProperty(h)&&(d[e+b+h]=g[h])}else d[e]=a[e]}return d},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},guid:function(a){return this.guid.id=this.guid.id||1,a.id=void 0===a.id?"j_"+this.guid.id++:a.id,a.id},mixin:function(){for(var b=arguments[0],c=1,d=arguments.length;d>c;c++){var e=arguments[c];(Object(e)===e||a.isFunction(e)||null!==e&&void 0!==e)&&a.each(e,function(c,d){return this.mixin.deep&&Object(c)===c?(b[d]||(b[d]=a.isArray(c)?[]:{}),void this.mixin(b[d],c)):void(b[d]!==c&&(this.mixin.supplement&&b.hasOwnProperty(d)||(b[d]=c)))},this)}return b},supplement:function(){this.mixin.supplement=!0;var a=this.mixin.apply(this,arguments);return this.mixin.supplement=!1,a},deepMixin:function(){this.mixin.deep=!0;var a=this.mixin.apply(this,arguments);return this.mixin.deep=!1,a},deepSupplement:function(){this.mixin.deep=this.mixin.supplement=!0;var a=this.mixin.apply(this,arguments);return this.mixin.deep=this.mixin.supplement=!1,a},normalizeEvent:function(a){return a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches.length?a.originalEvent.changedTouches[0]:a},nextFrame:function(){var b,c="undefined"!=typeof window;if(c&&(b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame),!b){var d=0;b=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-d)),e=setTimeout(function(){a(b+c)},c);return d=b+c,e}}return c?a.bind(b,window):b}(),cancelFrame:function(){var b,c="undefined"!=typeof window;return c&&(b=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame),b=b||clearTimeout,c?a.bind(b,window):b}(),findIntersection:function(b,e){var f=d.rect(c(b).bbox()).moveAndExpand(d.rect(-5,-5,10,10)),g=f.center(),h=d.rect(f).intersectionWithLineFromCenterToPoint(e);if(!h)return void 0;if(!a.contains(["PATH","CIRCLE","ELLIPSE","RECT","POLYGON","LINE","POLYLINE"],b.localName.toUpperCase()))return h;if(!b.isPointInStroke||!b.isPointInFill)return h;for(var i=h,j=b.getCTM(),k=c.createSVGPoint(0,0),l=h.distance(g);l>1;){if(h=h.move(g,-1),l=h.distance(g),k.x=h.x,k.y=h.y,k=k.matrixTransform(j.inverse()),b.isPointInStroke(k)||b.isPointInFill(k))return i;i=d.point(h)}return void 0},shapePerimeterConnectionPoint:function(a,b,c,e){var g,h=d.rect(b.getBBox());if(!c){var i=b.$(".scalable")[0],j=b.$(".rotatable")[0];i&&i.firstChild?c=i.firstChild:j&&j.firstChild&&(c=j.firstChild)}return g=c?f.util.findIntersection(c,e):h.intersectionWithLineFromCenterToPoint(e),g||h.center()},breakText:function(a,b,d,e){e=e||{};var f=b.width,g=b.height,h=e.svgDocument||c("svg").node,i=c("<text><tspan></tspan></text>").attr(d||{}).node,j=i.firstChild,k=document.createTextNode("");j.appendChild(k),h.appendChild(i),e.svgDocument||document.body.appendChild(h);for(var l,m=a.split(" "),n=[],o=[],p=0,q=0,r=m.length;r>p;p++){var s=m[p];if(k.data=o[q]?o[q]+" "+s:s,j.getComputedTextLength()<=f)o[q]=k.data,l&&(n[q++]=!0,l=0);else{if(!o[q]||l){var t=!!l;if(l=s.length-1,t||!l){if(!l){if(!o[q]){o=[];break}m.splice(p,2,s+m[p+1]),r--,n[q++]=!0,p--;continue}m[p]=s.substring(0,l),m[p+1]=s.substring(l)+m[p+1]}else m.splice(p,1,s.substring(0,l),s.substring(l)),r++,q&&!n[q-1]&&q--;p--;continue}q++,p--}if("undefined"!=typeof g){var u=u||1.25*i.getBBox().height;if(u*o.length>g){o.splice(Math.floor(g/u));break}}}return e.svgDocument?h.removeChild(i):document.body.removeChild(h),o.join("\n")},imageToDataUri:function(a,b){if(!a||"data:"===a.substr(0,"data:".length))return setTimeout(function(){b(null,a)},0);var c=document.createElement("canvas"),d=document.createElement("img");d.onload=function(){var e=c.getContext("2d");c.width=d.width,c.height=d.height,e.drawImage(d,0,0);try{var f=(a.split(".").pop()||"png","jpeg"),g=c.toDataURL(f)}catch(h){if(/\.svg$/.test(a)){var i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");i.open("GET",a,!1),i.send(null);var j=i.responseText;return b(null,"data:image/svg+xml,"+encodeURIComponent(j))}console.error(d.src,"fails to convert",h)}b(null,g)},d.ononerror=function(){b(new Error("Failed to load image."))},d.src=a},timing:{linear:function(a){return a},quad:function(a){return a*a},cubic:function(a){return a*a*a},inout:function(a){if(0>=a)return 0;if(a>=1)return 1;var b=a*a,c=b*a;return 4*(.5>a?c:3*(a-b)+c-.75)},exponential:function(a){return Math.pow(2,10*(a-1))},bounce:function(a){for(var b=0,c=1;1;b+=c,c/=2)if(a>=(7-4*b)/11){var d=(11-6*b-11*a)/4;return-d*d+c*c}},reverse:function(a){return function(b){return 1-a(1-b)}},reflect:function(a){return function(b){return.5*(.5>b?a(2*b):2-a(2-2*b))}},clamp:function(a,b,c){return b=b||0,c=c||1,function(d){var e=a(d);return b>e?b:e>c?c:e}},back:function(a){return a||(a=1.70158),function(b){return b*b*((a+1)*b-a)}},elastic:function(a){return a||(a=1.5),function(b){return Math.pow(2,10*(b-1))*Math.cos(20*Math.PI*a/3*b)}}},interpolate:{number:function(a,b){var c=b-a;return function(b){return a+c*b}},object:function(b,c){var d=a.keys(b);return function(a){var e,f,g={};for(e=d.length-1;-1!=e;e--)f=d[e],g[f]=b[f]+(c[f]-b[f])*a;return g}},hexColor:function(a,b){var c=parseInt(a.slice(1),16),d=parseInt(b.slice(1),16),e=255&c,f=(255&d)-e,g=65280&c,h=(65280&d)-g,i=16711680&c,j=(16711680&d)-i;return function(a){var b=e+f*a&255,c=g+h*a&65280,d=i+j*a&16711680;return"#"+(1<<24|b|c|d).toString(16).slice(1)}},unit:function(a,b){var c=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/,d=c.exec(a),e=c.exec(b),f=e[1].indexOf("."),g=f>0?e[1].length-f-1:0,a=+d[1],h=+e[1]-a,i=d[2];return function(b){return(a+h*b).toFixed(g)+i}}},filter:{blur:function(b){var c=a.isFinite(b.x)?b.x:2;return a.template('<filter><feGaussianBlur stdDeviation="${stdDeviation}"/></filter>',{stdDeviation:a.isFinite(b.y)?[c,b.y]:c})},dropShadow:function(b){var c="SVGFEDropShadowElement"in window?'<filter><feDropShadow stdDeviation="${blur}" dx="${dx}" dy="${dy}" flood-color="${color}" flood-opacity="${opacity}"/></filter>':'<filter><feGaussianBlur in="SourceAlpha" stdDeviation="${blur}"/><feOffset dx="${dx}" dy="${dy}" result="offsetblur"/><feFlood flood-color="${color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="${opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';return a.template(c,{dx:b.dx||0,dy:b.dy||0,opacity:a.isFinite(b.opacity)?b.opacity:1,color:b.color||"black",blur:a.isFinite(b.blur)?b.blur:4})},grayscale:function(b){var c=a.isFinite(b.amount)?b.amount:1;return a.template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0"/></filter>',{a:.2126+.7874*(1-c),b:.7152-.7152*(1-c),c:.0722-.0722*(1-c),d:.2126-.2126*(1-c),e:.7152+.2848*(1-c),f:.0722-.0722*(1-c),g:.2126-.2126*(1-c),h:.0722+.9278*(1-c)})},sepia:function(b){var c=a.isFinite(b.amount)?b.amount:1;return a.template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0"/></filter>',{a:.393+.607*(1-c),b:.769-.769*(1-c),c:.189-.189*(1-c),d:.349-.349*(1-c),e:.686+.314*(1-c),f:.168-.168*(1-c),g:.272-.272*(1-c),h:.534-.534*(1-c),i:.131+.869*(1-c)})},saturate:function(b){var c=a.isFinite(b.amount)?b.amount:1;return a.template('<filter><feColorMatrix type="saturate" values="${amount}"/></filter>',{amount:1-c})},hueRotate:function(b){return a.template('<filter><feColorMatrix type="hueRotate" values="${angle}"/></filter>',{angle:b.angle||0})},invert:function(b){var c=a.isFinite(b.amount)?b.amount:1;return a.template('<filter><feComponentTransfer><feFuncR type="table" tableValues="${amount} ${amount2}"/><feFuncG type="table" tableValues="${amount} ${amount2}"/><feFuncB type="table" tableValues="${amount} ${amount2}"/></feComponentTransfer></filter>',{amount:c,amount2:1-c})},brightness:function(b){return a.template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}"/><feFuncG type="linear" slope="${amount}"/><feFuncB type="linear" slope="${amount}"/></feComponentTransfer></filter>',{amount:a.isFinite(b.amount)?b.amount:1})},contrast:function(b){var c=a.isFinite(b.amount)?b.amount:1;return a.template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}" intercept="${amount2}"/><feFuncG type="linear" slope="${amount}" intercept="${amount2}"/><feFuncB type="linear" slope="${amount}" intercept="${amount2}"/></feComponentTransfer></filter>',{amount:c,amount2:.5-c/2})}},format:{number:function(a,b,c){function d(a){for(var b=a.length,d=[],e=0,f=c.grouping[0];b>0&&f>0;)d.push(a.substring(b-=f,b+f)),f=c.grouping[e=(e+1)%c.grouping.length];return d.reverse().join(c.thousands)}c=c||{currency:["$",""],decimal:".",thousands:",",grouping:[3]};var e=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,f=e.exec(a),g=f[1]||" ",h=f[2]||">",i=f[3]||"",j=f[4]||"",k=f[5],l=+f[6],m=f[7],n=f[8],o=f[9],p=1,q="",r="",s=!1;switch(n&&(n=+n.substring(1)),(k||"0"===g&&"="===h)&&(k=g="0",h="=",m&&(l-=Math.floor((l-1)/4))),o){case"n":m=!0,o="g";break;case"%":p=100,r="%",o="f";break;case"p":p=100,r="%",o="r";break;case"b":case"o":case"x":case"X":"#"===j&&(q="0"+o.toLowerCase());case"c":case"d":s=!0,n=0;break;case"s":p=-1,o="r"}"$"===j&&(q=c.currency[0],r=c.currency[1]),"r"!=o||n||(o="g"),null!=n&&("g"==o?n=Math.max(1,Math.min(21,n)):("e"==o||"f"==o)&&(n=Math.max(0,Math.min(20,n))));var t=k&&m;if(s&&b%1)return"";var u=0>b||0===b&&0>1/b?(b=-b,"-"):i,v=r;if(0>p){var w=this.prefix(b,n);b=w.scale(b),v=w.symbol+r}else b*=p;b=this.convert(o,b,n);var x=b.lastIndexOf("."),y=0>x?b:b.substring(0,x),z=0>x?"":c.decimal+b.substring(x+1);!k&&m&&c.grouping&&(y=d(y));var A=q.length+y.length+z.length+(t?0:u.length),B=l>A?new Array(A=l-A+1).join(g):"";return t&&(y=d(B+y)),u+=q,b=y+z,("<"===h?u+b+B:">"===h?B+u+b:"^"===h?B.substring(0,A>>=1)+u+b+B.substring(A):u+(t?b:B+b))+v},string:function(a,b){for(var c,d="{",e=!1,f=[];-1!==(c=a.indexOf(d));){var g,h,i;if(g=a.slice(0,c),e){h=g.split(":"),i=h.shift().split("."),g=b;for(var j=0;j<i.length;j++)g=g[i[j]];h.length&&(g=this.number(h,g))}f.push(g),a=a.slice(c+1),d=(e=!e)?"}":"{"}return f.push(a),f.join("")},convert:function(a,b,c){switch(a){case"b":return b.toString(2);case"c":return String.fromCharCode(b);case"o":return b.toString(8);case"x":return b.toString(16);case"X":return b.toString(16).toUpperCase();case"g":return b.toPrecision(c);case"e":return b.toExponential(c);case"f":return b.toFixed(c);case"r":return(b=this.round(b,this.precision(b,c))).toFixed(Math.max(0,Math.min(20,this.precision(b*(1+1e-15),c))));default:return b+""}},round:function(a,b){return b?Math.round(a*(b=Math.pow(10,b)))/b:Math.round(a)},precision:function(a,b){return b-(a?Math.ceil(Math.log(a)/Math.LN10):1)},prefix:function(b,c){var d=a.map(["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"],function(a,b){var c=Math.pow(10,3*abs(8-b));return{scale:b>8?function(a){return a/c}:function(a){return a*c},symbol:a}}),e=0;return b&&(0>b&&(b*=-1),c&&(b=this.round(b,this.precision(b,c))),e=1+Math.floor(1e-12+Math.log(b)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((0>=e?e+1:e-1)/3)))),d[8+e/3]}}}};return f}),function(a,b){if("function"==typeof define&&define.amd)define(["JointJS","lodash","Backbone","Vectorizer","Geometry","jQuery"],b);else if("object"==typeof exports){var c=require("JointJS"),d=require("$")||require("jQuery"),e=require("Backbone"),f=require("lodash"),g=require("V")||require("Vectorizer"),h=require("G")||require("Geometry")||require("g");b(c,f,e,g,h,d)}else{var c=a.joint,d=a.$||a.jQuery,e=a.Backbone,f=a._,g=a.V||a.Vectorizer,h=a.G||a.Geometry||a.g;b(c,f,e,g,h,d)}}(this,function(a,b,c,d,e,f){a.dia.GraphCells=c.Collection.extend({initialize:function(){this.on("change:z",this.sort,this)},model:function(b,c){if("link"===b.type)return new a.dia.Link(b,c);var d=b.type.split(".")[0],e=b.type.split(".")[1];return a.shapes[d]&&a.shapes[d][e]?new a.shapes[d][e](b,c):new a.dia.Element(b,c)},comparator:function(a){return a.get("z")||0},getConnectedLinks:function(a,c){c=c||{},b.isUndefined(c.inbound)&&b.isUndefined(c.outbound)&&(c.inbound=c.outbound=!0);var d=this.filter(function(b){var d=b.get("source"),e=b.get("target");return d&&d.id===a.id&&c.outbound||e&&e.id===a.id&&c.inbound});if(c.deep){var e=a.getEmbeddedCells({deep:!0});b.each(this.difference(d,e),function(a){if(c.outbound){var f=a.get("source");if(f&&f.id&&b.find(e,{id:f.id}))return void d.push(a)}if(c.inbound){var g=a.get("target");g&&g.id&&b.find(e,{id:g.id})&&d.push(a)}})}return d},getCommonAncestor:function(){var a=b.map(arguments,function(a){for(var b=[a.id],c=a.get("parent");c;)b.push(c),c=this.get(c).get("parent");return b},this);a=b.sortBy(a,"length");var c=b.find(a.shift(),function(c){return b.every(a,function(a){return b.contains(a,c)})});return this.get(c)}}),a.dia.Graph=c.Model.extend({initialize:function(b,c){this.set("cells",new a.dia.GraphCells([],{model:c&&c.cellModel})),this.get("cells").on("all",this.trigger,this),this.get("cells").on("remove",this.removeCell,this)},toJSON:function(){var a=c.Model.prototype.toJSON.apply(this,arguments);return a.cells=this.get("cells").toJSON(),a},fromJSON:function(a,c){if(!a.cells)throw new Error("Graph JSON must contain cells array.");this.set(b.omit(a,"cells"),c),this.resetCells(a.cells,c)},clear:function(a){this.trigger("batch:start"),this.get("cells").remove(this.get("cells").models,a),this.trigger("batch:stop")},_prepareCell:function(a){return a instanceof c.Model&&b.isUndefined(a.get("z"))?a.set("z",this.maxZIndex()+1,{silent:!0}):b.isUndefined(a.z)&&(a.z=this.maxZIndex()+1),a},maxZIndex:function(){var a=this.get("cells").last();return a?a.get("z")||0:0},addCell:function(a,c){return b.isArray(a)?this.addCells(a,c):(this.get("cells").add(this._prepareCell(a),c||{}),this)},addCells:function(a,c){return c=c||{},c.position=a.length,b.each(a,function(a){c.position--,this.addCell(a,c)},this),this},resetCells:function(a,c){return this.get("cells").reset(b.map(a,this._prepareCell,this),c),this},removeCell:function(a,b,c){c&&c.disconnectLinks?this.disconnectLinks(a,c):this.removeLinks(a,c),this.get("cells").remove(a,{silent:!0})},getCell:function(a){return this.get("cells").get(a)},getElements:function(){return this.get("cells").filter(function(b){return b instanceof a.dia.Element})},getLinks:function(){return this.get("cells").filter(function(b){return b instanceof a.dia.Link})},getConnectedLinks:function(a,b){return this.get("cells").getConnectedLinks(a,b)},getNeighbors:function(a){var c=this.getConnectedLinks(a),d=[],e=this.get("cells");return b.each(c,function(b){var c=b.get("source"),f=b.get("target");if(!c.x){var g=e.get(c.id);g!==a&&d.push(g)}if(!f.x){var h=e.get(f.id);h!==a&&d.push(h)}}),d},disconnectLinks:function(a,c){b.each(this.getConnectedLinks(a),function(b){b.set(b.get("source").id===a.id?"source":"target",e.point(0,0),c)})},removeLinks:function(a,c){b.invoke(this.getConnectedLinks(a),"remove",c)},findModelsFromPoint:function(a){return b.filter(this.getElements(),function(b){return b.getBBox().containsPoint(a)})},findModelsInArea:function(a){return b.filter(this.getElements(),function(b){return b.getBBox().intersect(a)})},getBBox:function(a){var c={x:1/0,y:1/0},d={x:0,y:0};return b.each(a,function(a){var b=a.getBBox();c.x=Math.min(c.x,b.x),c.y=Math.min(c.y,b.y),d.x=Math.max(d.x,b.x+b.width),d.y=Math.max(d.y,b.y+b.height)}),e.rect(c.x,c.y,d.x-c.x,d.y-c.y)},getCommonAncestor:function(){var a=this.get("cells");return a.getCommonAncestor.apply(a,arguments)}})}),"object"==typeof exports&&(module.exports.Graph=joint.dia.Graph),function(a,b){if("function"==typeof define&&define.amd)define(["JointJS","lodash","Backbone","Vectorizer","Geometry","jQuery"],b);else if("object"==typeof exports){var c=require("JointJS"),d=require("$")||require("jQuery"),e=require("Backbone"),f=require("lodash"),g=require("V")||require("Vectorizer"),h=require("G")||require("Geometry")||require("g");b(c,f,e,g,h,d)}else{var c=a.joint,d=a.$||a.jQuery,e=a.Backbone,f=a._,g=a.V||a.Vectorizer,h=a.G||a.Geometry||a.g;b(c,f,e,g,h,d)}}(this,function(a,b,c,d,e,f){a.dia.Cell=c.Model.extend({constructor:function(a,c){var d,e=a||{};this.cid=b.uniqueId("c"),this.attributes={},c&&c.collection&&(this.collection=c.collection),c&&c.parse&&(e=this.parse(e,c)||{}),(d=b.result(this,"defaults"))&&(e=b.merge({},d,e)),this.set(e,c),this.changed={},this.initialize.apply(this,arguments)},toJSON:function(){var a=this.constructor.prototype.defaults.attrs||{},c=this.attributes.attrs,d={};b.each(c,function(c,e){var f=a[e];b.each(c,function(a,c){b.isObject(a)&&!b.isArray(a)?b.each(a,function(a,g){f&&f[c]&&b.isEqual(f[c][g],a)||(d[e]=d[e]||{},(d[e][c]||(d[e][c]={}))[g]=a)}):f&&b.isEqual(f[c],a)||(d[e]=d[e]||{},d[e][c]=a)})});var e=b.cloneDeep(b.omit(this.attributes,"attrs"));return e.attrs=d,e},initialize:function(b){b&&b.id||this.set("id",a.util.uuid(),{silent:!0}),this._transitionIds={},this.processPorts(),this.on("change:attrs",this.processPorts,this)},processPorts:function(){var a=this.ports,c={};b.each(this.get("attrs"),function(a,d){a&&a.port&&(b.isUndefined(a.port.id)?c[a.port]={id:a.port}:c[a.port.id]=a.port)});var d={};if(b.each(a,function(a,b){c[b]||(d[b]=!0)}),this.collection&&!b.isEmpty(d)){var e=this.collection.getConnectedLinks(this,{inbound:!0});b.each(e,function(a){d[a.get("target").port]&&a.remove()});var f=this.collection.getConnectedLinks(this,{outbound:!0});b.each(f,function(a){d[a.get("source").port]&&a.remove()})}this.ports=c},remove:function(a){var c=this.collection;c&&c.trigger("batch:start");var d=this.get("parent");if(d){var e=this.collection&&this.collection.get(d);e.unembed(this)}return b.invoke(this.getEmbeddedCells(),"remove",a),this.trigger("remove",this,this.collection,a),c&&c.trigger("batch:stop"),this},toFront:function(a){if(this.collection){a=a||{};var c=(this.collection.last().get("z")||0)+1;if(this.trigger("batch:start").set("z",c,a),a.deep){var d=this.getEmbeddedCells({deep:!0,breadthFirst:!0});b.each(d,function(b){b.set("z",++c,a)})}this.trigger("batch:stop")}return this},toBack:function(a){if(this.collection){a=a||{};var c=(this.collection.first().get("z")||0)-1;if(this.trigger("batch:start"),a.deep){var d=this.getEmbeddedCells({deep:!0,breadthFirst:!0});b.eachRight(d,function(b){b.set("z",c--,a)})}this.set("z",c,a).trigger("batch:stop")}return this},embed:function(a,c){if(this==a||this.isEmbeddedIn(a))throw new Error("Recursive embedding not allowed.");this.trigger("batch:start");var d=b.clone(this.get("embeds")||[]);return d[a.isLink()?"unshift":"push"](a.id),a.set("parent",this.id,c),this.set("embeds",b.uniq(d),c),this.trigger("batch:stop"),this},unembed:function(a,c){return this.trigger("batch:start"),a.unset("parent",c),this.set("embeds",b.without(this.get("embeds"),a.id),c),this.trigger("batch:stop"),this},getEmbeddedCells:function(a){if(a=a||{},this.collection){var c;if(a.deep)if(a.breadthFirst){c=[];for(var d=this.getEmbeddedCells();d.length>0;){var e=d.shift();c.push(e),d.push.apply(d,e.getEmbeddedCells())}}else c=this.getEmbeddedCells(),b.each(c,function(b){c.push.apply(c,b.getEmbeddedCells(a))});else c=b.map(this.get("embeds"),this.collection.get,this.collection);return c}return[]},isEmbeddedIn:function(a,c){var d=b.isString(a)?a:a.id;c=b.defaults({deep:!0},c);var e=this.get("parent");if(this.collection&&c.deep){for(;e;){if(e==d)return!0;e=this.collection.get(e).get("parent")}return!1}return e==d},clone:function(d){d=d||{};var e=c.Model.prototype.clone.apply(this,arguments);if(e.set("id",a.util.uuid(),{silent:!0}),e.set("embeds",""),!d.deep)return e;var f=b.sortBy(this.getEmbeddedCells(),function(b){return b instanceof a.dia.Element}),g=[e],h={};return b.each(f,function(c){var d=c.clone({deep:!0});e.embed(d[0]),b.each(d,function(d){if(d instanceof a.dia.Link)return d.get("source").id==this.id&&d.prop("source",{id:e.id}),d.get("target").id==this.id&&d.prop("target",{id:e.id}),void(h[c.id]=d);g.push(d);var f=this.collection.getConnectedLinks(c,{inbound:!0});b.each(f,function(a){var b=h[a.id]||a.clone();h[a.id]=b,b.prop("target",{id:d.id})});var i=this.collection.getConnectedLinks(c,{outbound:!0});b.each(i,function(a){var b=h[a.id]||a.clone();h[a.id]=b,b.prop("source",{id:d.id})})},this)},this),g=g.concat(b.values(h))},prop:function(c,d,e){var f="/";if(b.isString(c)){if("undefined"!=typeof d){var g=c,h=g.split("/"),i=h[0];if(e=e||{},e.propertyPath=g,e.propertyValue=d,1==h.length)return this.set(i,d,e);var j={},k=j,l=i;b.each(b.rest(h),function(a){k=k[l]=b.isFinite(Number(a))?[]:{},l=a}),j=a.util.setByPath(j,g,d,"/");var m=b.merge({},this.attributes);e.rewrite&&a.util.unsetByPath(m,g,"/");var n=b.merge(m,j);return this.set(i,n[i],e)}return a.util.getByPath(this.attributes,c,f)}return this.set(b.merge({},this.attributes,c),d)},attr:function(a,c,d){return b.isString(a)?this.prop("attrs/"+a,c,d):this.prop({attrs:a},c)},removeAttr:function(c,d){if(b.isArray(c))return b.each(c,function(a){this.removeAttr(a,d)},this),this;var e=a.util.unsetByPath(b.merge({},this.get("attrs")),c,"/");return this.set("attrs",e,b.extend({dirty:!0},d))},transition:function(c,d,e,f){f=f||"/";var g={duration:100,delay:10,timingFunction:a.util.timing.linear,valueFunction:a.util.interpolate.number};e=b.extend(g,e);var h,i=0,j=b.bind(function(b){var d,f,g;i=i||b,b-=i,f=b/e.duration,1>f?this._transitionIds[c]=d=a.util.nextFrame(j):(f=1,delete this._transitionIds[c]),g=h(e.timingFunction(f)),e.transitionId=d,this.prop(c,g,e),d||this.trigger("transition:end",this,c)},this),k=b.bind(function(b){this.stopTransitions(c),h=e.valueFunction(a.util.getByPath(this.attributes,c,f),d),this._transitionIds[c]=a.util.nextFrame(b),this.trigger("transition:start",this,c)},this);return b.delay(k,e.delay,j)},getTransitions:function(){return b.keys(this._transitionIds)},stopTransitions:function(c,d){d=d||"/";var e=c&&c.split(d);return b(this._transitionIds).keys().filter(e&&function(a){return b.isEqual(e,a.split(d).slice(0,e.length))}).each(function(b){a.util.cancelFrame(this._transitionIds[b]),delete this._transitionIds[b],this.trigger("transition:end",this,b)},this),this},addTo:function(a){return a.addCell(this),this},findView:function(a){return a.findViewByModel(this)},isLink:function(){return!1}}),a.dia.CellView=c.View.extend({tagName:"g",attributes:function(){return{"model-id":this.model.id}},constructor:function(a){this._configure(a),c.View.apply(this,arguments)},_configure:function(c){this.options&&(c=b.extend({},b.result(this,"options"),c)),this.options=c,this.options.id=this.options.id||a.util.guid(this)},initialize:function(){b.bindAll(this,"remove","update"),this.$el.data("view",this),this.listenTo(this.model,"remove",this.remove),this.listenTo(this.model,"change:attrs",this.onChangeAttrs)},onChangeAttrs:function(a,b,c){return c.dirty?this.render():this.update()},_ensureElement:function(){var a;if(this.el)a=b.result(this,"el");else{var c=b.extend({id:this.id},b.result(this,"attributes"));this.className&&(c["class"]=b.result(this,"className")),a=d(b.result(this,"tagName"),c).node}this.setElement(a,!1)},findBySelector:function(a){var b="."===a?this.$el:this.$el.find(a);return b},notify:function(a){if(this.paper){var b=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[a].concat(b)),this.paper.trigger.apply(this.paper,[a,this].concat(b))}},getStrokeBBox:function(a){var b=!!a;a=a||this.el;var c,f=d(a).bbox(!1,this.paper.viewport);return c=b?d(a).attr("stroke-width"):this.model.attr("rect/stroke-width")||this.model.attr("circle/stroke-width")||this.model.attr("ellipse/stroke-width")||this.model.attr("path/stroke-width"),c=parseFloat(c)||0,e.rect(f).moveAndExpand({x:-c/2,y:-c/2,width:c,height:c})},getBBox:function(){return d(this.el).bbox()},highlight:function(a,b){return a=a?this.$(a)[0]||this.el:this.el,b=b||{},b.partial=a!=this.el,this.notify("cell:highlight",a,b),this},unhighlight:function(a,b){return a=a?this.$(a)[0]||this.el:this.el,b=b||{},b.partial=a!=this.el,this.notify("cell:unhighlight",a,b),this},findMagnet:function(a){var b=this.$(a);if(0===b.length||b[0]===this.el){var c=this.model.get("attrs")||{};return c["."]&&c["."].magnet===!1?void 0:this.el}return b.attr("magnet")?b[0]:this.findMagnet(b.parent())},applyFilter:function(b,c){var e=this.findBySelector(b),f=c.name+this.paper.svg.id+a.util.hashCode(JSON.stringify(c));if(!this.paper.svg.getElementById(f)){var g=a.util.filter[c.name]&&a.util.filter[c.name](c.args||{});if(!g)throw new Error("Non-existing filter "+c.name);var h=d(g);h.attr({filterUnits:"objectBoundingBox",x:-1,y:-1,width:3,height:3}),c.attrs&&h.attr(c.attrs),h.node.id=f,d(this.paper.svg).defs().append(h)}e.each(function(){d(this).attr("filter","url(#"+f+")")})},applyGradient:function(c,e,f){var g=this.findBySelector(c),h=f.type+this.paper.svg.id+a.util.hashCode(JSON.stringify(f));if(!this.paper.svg.getElementById(h)){var i=["<"+f.type+">",b.map(f.stops,function(a){return'<stop offset="'+a.offset+'" stop-color="'+a.color+'" stop-opacity="'+(b.isFinite(a.opacity)?a.opacity:1)+'" />'}).join(""),"</"+f.type+">"].join(""),j=d(i);f.attrs&&j.attr(f.attrs),j.node.id=h,d(this.paper.svg).defs().append(j)}g.each(function(){d(this).attr(e,"url(#"+h+")")})},getSelector:function(a,b){if(a===this.el)return b;var c=f(a).index();return b=a.tagName+":nth-child("+(c+1)+") "+(b||""),this.getSelector(f(a).parent()[0],b+" ")},pointerdblclick:function(a,b,c){this.notify("cell:pointerdblclick",a,b,c)},pointerclick:function(a,b,c){this.notify("cell:pointerclick",a,b,c)},pointerdown:function(a,b,c){this.model.collection&&(this.model.trigger("batch:start"),this._collection=this.model.collection),this.notify("cell:pointerdown",a,b,c)},pointermove:function(a,b,c){this.notify("cell:pointermove",a,b,c)},pointerup:function(a,b,c){this.notify("cell:pointerup",a,b,c),this._collection&&(this._collection.trigger("batch:stop"),delete this._collection)},mouseover:function(a){this.notify("cell:mouseover",a)},mouseout:function(a){this.notify("cell:mouseout",a)}})}),"object"==typeof exports&&(module.exports.Cell=joint.dia.Cell,module.exports.CellView=joint.dia.CellView),function(a,b){if("function"==typeof define&&define.amd)define(["JointJS","lodash","Backbone","Vectorizer","Geometry","jQuery"],b);else if("object"==typeof exports){var c=require("JointJS"),d=require("$")||require("jQuery"),e=require("Backbone"),f=require("lodash"),g=require("V")||require("Vectorizer"),h=require("G")||require("Geometry")||require("g");b(c,f,e,g,h,d)}else{var c=a.joint,d=a.$||a.jQuery,e=a.Backbone,f=a._,g=a.V||a.Vectorizer,h=a.G||a.Geometry||a.g;b(c,f,e,g,h,d)}}(this,function(a,b,c,d,e,f){a.dia.Element=a.dia.Cell.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},position:function(a,c,d){var f=b.isNumber(c);if(d=(f?d:a)||{},d.parentRelative){if(!this.collection)throw new Error("Element must be part of a collection.");var g=this.collection.get(this.get("parent")),h=g&&!g.isLink()?g.get("position"):{x:0,y:0}}if(f)return d.parentRelative&&(a+=h.x,c+=h.y),this.set("position",{x:a,y:c},d);var i=e.point(this.get("position"));return d.parentRelative?i.difference(h):i},translate:function(c,d,e){if(d=d||0,0===c&&0===d)return this;e=e||{},e.translateBy=e.translateBy||this.id,e.tx=c,e.ty=d;var f=this.get("position")||{x:0,y:0},g={x:f.x+c||0,y:f.y+d||0};return e.transition?(b.isObject(e.transition)||(e.transition={}),this.transition("position",g,b.extend({},e.transition,{valueFunction:a.util.interpolate.object}))):(this.set("position",g,e),b.invoke(this.getEmbeddedCells(),"translate",c,d,e)),this},resize:function(a,b){return this.trigger("batch:start"),this.set("size",{width:a,height:b}),this.trigger("batch:stop"),this},rotate:function(a,b,c){if(c){var d=this.getBBox().center(),e=this.get("size"),f=this.get("position");d.rotate(c,(this.get("angle")||0)-a);var g=d.x-e.width/2-f.x,h=d.y-e.height/2-f.y;this.trigger("batch:start"),this.translate(g,h),this.rotate(a,b),this.trigger("batch:stop")}else this.set("angle",b?a:((this.get("angle")||0)+a)%360);return this},getBBox:function(){var a=this.get("position"),b=this.get("size");return e.rect(a.x,a.y,b.width,b.height)}}),a.dia.ElementView=a.dia.CellView.extend({className:function(){return"element "+this.model.get("type").split(".").join(" ")},initialize:function(){b.bindAll(this,"translate","resize","rotate"),a.dia.CellView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:position",this.translate),this.listenTo(this.model,"change:size",this.resize),this.listenTo(this.model,"change:angle",this.rotate)},update:function(a,c){var e=this.model.get("attrs"),g=d(this.$(".rotatable")[0]);if(g){var h=g.attr("transform");g.attr("transform","")}var i=[];b.each(c||e,function(a,c){var e=this.findBySelector(c);if(0!==e.length){var g=["style","text","html","ref-x","ref-y","ref-dx","ref-dy","ref-width","ref-height","ref","x-alignment","y-alignment","port"];b.isObject(a.filter)&&(g.push("filter"),this.applyFilter(c,a.filter)),b.isObject(a.fill)&&(g.push("fill"),this.applyGradient(c,"fill",a.fill)),b.isObject(a.stroke)&&(g.push("stroke"),this.applyGradient(c,"stroke",a.stroke)),b.isUndefined(a.text)||(e.each(function(){d(this).text(a.text+"",{lineHeight:a.lineHeight,textPath:a.textPath})}),g.push("lineHeight","textPath"));var h=b.omit(a,g);e.each(function(){d(this).attr(h)}),a.port&&e.attr("port",b.isUndefined(a.port.id)?a.port:a.port.id),a.style&&e.css(a.style),b.isUndefined(a.html)||e.each(function(){f(this).html(a.html+"")}),b.isUndefined(a["ref-x"])&&b.isUndefined(a["ref-y"])&&b.isUndefined(a["ref-dx"])&&b.isUndefined(a["ref-dy"])&&b.isUndefined(a["x-alignment"])&&b.isUndefined(a["y-alignment"])&&b.isUndefined(a["ref-width"])&&b.isUndefined(a["ref-height"])||b.each(e,function(a,b,c){var d=f(a);d.selector=c.selector,i.push(d)})}},this);var j=this.el.getBBox();c=c||{},b.each(i,function(a){var d=c[a.selector],f=d?b.merge({},e[a.selector],d):e[a.selector];this.positionRelative(a,j,f)},this),g&&g.attr("transform",h||"")},positionRelative:function(a,c,e){function f(a){return b.isNumber(a)&&!b.isNaN(a)}var g=e.ref,h=parseFloat(e["ref-x"]),i=parseFloat(e["ref-y"]),j=parseFloat(e["ref-dx"]),k=parseFloat(e["ref-dy"]),l=e["y-alignment"],m=e["x-alignment"],n=parseFloat(e["ref-width"]),o=parseFloat(e["ref-height"]),p=b.contains(b.pluck(b.pluck(a.parents("g"),"className"),"baseVal"),"scalable");g&&(c=d(this.findBySelector(g)[0]).bbox(!1,this.el));var q=d(a[0]);q.attr("transform")&&q.attr("transform",q.attr("transform").replace(/translate\([^)]*\)/g,"").trim()||"");var r=0,s=0;if(f(n)&&(n>=0&&1>=n?q.attr("width",n*c.width):q.attr("width",Math.max(n+c.width,0))),
f(o)&&(o>=0&&1>=o?q.attr("height",o*c.height):q.attr("height",Math.max(o+c.height,0))),f(j))if(p){var t=d(this.$(".scalable")[0]).scale();r=c.x+c.width+j/t.sx}else r=c.x+c.width+j;if(f(k))if(p){var t=d(this.$(".scalable")[0]).scale();s=c.y+c.height+k/t.sy}else s=c.y+c.height+k;if(f(h))if(h>0&&1>h)r=c.x+c.width*h;else if(p){var t=d(this.$(".scalable")[0]).scale();r=c.x+h/t.sx}else r=c.x+h;if(f(i))if(i>0&&1>i)s=c.y+c.height*i;else if(p){var t=d(this.$(".scalable")[0]).scale();s=c.y+i/t.sy}else s=c.y+i;var u=q.bbox(!1,this.paper.viewport);"middle"===l?s-=u.height/2:f(l)&&(s+=l>-1&&1>l?u.height*l:l),"middle"===m?r-=u.width/2:f(m)&&(r+=m>-1&&1>m?u.width*m:m),q.translate(r,s)},renderMarkup:function(){var a=this.model.markup||this.model.get("markup");if(!a)throw new Error("properties.markup is missing while the default render() implementation is used.");var b=d(a);d(this.el).append(b)},render:function(){return this.$el.empty(),this.renderMarkup(),this.update(),this.resize(),this.rotate(),this.translate(),this},scale:function(a,b){d(this.el).scale(a,b)},resize:function(){var a=this.model.get("size")||{width:1,height:1},b=this.model.get("angle")||0,c=d(this.$(".scalable")[0]);if(c){var e=c.bbox(!0);c.attr("transform","scale("+a.width/(e.width||1)+","+a.height/(e.height||1)+")");var f=d(this.$(".rotatable")[0]),g=f&&f.attr("transform");if(g&&"null"!==g){f.attr("transform",g+" rotate("+-b+","+a.width/2+","+a.height/2+")");var h=c.bbox(!1,this.paper.viewport);this.model.set("position",{x:h.x,y:h.y}),this.rotate()}this.update()}},translate:function(a,b,c){var e=this.model.get("position")||{x:0,y:0};d(this.el).attr("transform","translate("+e.x+","+e.y+")")},rotate:function(){var a=d(this.$(".rotatable")[0]);if(a){var b=this.model.get("angle")||0,c=this.model.get("size")||{width:1,height:1},e=c.width/2,f=c.height/2;a.attr("transform","rotate("+b+","+e+","+f+")")}},getBBox:function(b){if(b&&b.useModelGeometry){var c=this.model.getBBox().bbox(this.model.get("angle")),e=this.paper.viewport.getCTM();return d.transformRect(c,e)}return a.dia.CellView.prototype.getBBox.apply(this,arguments)},findParentsByKey:function(a){var b=this.model.getBBox();return"bbox"==a?this.paper.model.findModelsInArea(b):this.paper.model.findModelsFromPoint(b[a]())},prepareEmbedding:function(){this.model.toFront({deep:!0,ui:!0}),b.invoke(this.paper.model.getConnectedLinks(this.model,{deep:!0}),"toFront",{ui:!0});var a=this.model.get("parent");a&&this.paper.model.getCell(a).unembed(this.model,{ui:!0})},processEmbedding:function(a){a=a||this.paper.options;var c=this.findParentsByKey(a.findParentBy);c=b.reject(c,function(a){return this.model.id==a.id||a.isEmbeddedIn(this.model)},this),a.frontParentOnly&&(c=c.slice(-1));for(var d=null,e=this._candidateEmbedView,f=c.length-1;f>=0;f--){var g=c[f];if(e&&e.model.id==g.id){d=e;break}var h=g.findView(this.paper);if(a.validateEmbedding.call(this.paper,this,h)){d=h;break}}d&&d!=e&&(e&&e.unhighlight(null,{embedding:!0}),this._candidateEmbedView=d.highlight(null,{embedding:!0})),!d&&e&&(e.unhighlight(null,{embedding:!0}),delete this._candidateEmbedView)},finalizeEmbedding:function(){var a=this._candidateEmbedView;a&&(a.model.embed(this.model,{ui:!0}),a.unhighlight(null,{embedding:!0}),delete this._candidateEmbedView),b.invoke(this.paper.model.getConnectedLinks(this.model,{deep:!0}),"reparent",{ui:!0})},pointerdown:function(b,c,d){if(this.model.trigger("batch:start"),b.target.getAttribute("magnet")&&this.paper.options.validateMagnet.call(this.paper,this,b.target)){var e=this.paper.getDefaultLink(this,b.target);e.set({source:{id:this.model.id,selector:this.getSelector(b.target),port:f(b.target).attr("port")},target:{x:c,y:d}}),this.paper.model.addCell(e),this._linkView=this.paper.findViewByModel(e),this._linkView.startArrowheadMove("target")}else this._dx=c,this._dy=d,a.dia.CellView.prototype.pointerdown.apply(this,arguments)},pointermove:function(c,d,f){if(this._linkView)this._linkView.pointermove(c,d,f);else{var g=this.paper.options.gridSize,h=b.isFunction(this.options.interactive)?this.options.interactive(this,"pointermove"):this.options.interactive;if(h!==!1){var i=this.model.get("position");this.model.translate(e.snapToGrid(i.x,g)-i.x+e.snapToGrid(d-this._dx,g),e.snapToGrid(i.y,g)-i.y+e.snapToGrid(f-this._dy,g)),this.paper.options.embeddingMode&&(this._inProcessOfEmbedding||(this.prepareEmbedding(),this._inProcessOfEmbedding=!0),this.processEmbedding())}this._dx=e.snapToGrid(d,g),this._dy=e.snapToGrid(f,g),a.dia.CellView.prototype.pointermove.apply(this,arguments)}},pointerup:function(b,c,d){this._linkView?(this._linkView.pointerup(b,c,d),delete this._linkView):(this._inProcessOfEmbedding&&(this.finalizeEmbedding(),this._inProcessOfEmbedding=!1),a.dia.CellView.prototype.pointerup.apply(this,arguments)),this.model.trigger("batch:stop")}})}),"object"==typeof exports&&(module.exports.Element=joint.dia.Element,module.exports.ElementView=joint.dia.ElementView),function(a,b){if("function"==typeof define&&define.amd)define(["JointJS","lodash","Backbone","Vectorizer","Geometry","jQuery"],b);else if("object"==typeof exports){var c=require("JointJS"),d=require("$")||require("jQuery"),e=require("Backbone"),f=require("lodash"),g=require("V")||require("Vectorizer"),h=require("G")||require("Geometry")||require("g");b(c,f,e,g,h,d)}else{var c=a.joint,d=a.$||a.jQuery,e=a.Backbone,f=a._,g=a.V||a.Vectorizer,h=a.G||a.Geometry||a.g;b(c,f,e,g,h,d)}}(this,function(a,b,c,d,e,f){a.dia.Link=a.dia.Cell.extend({markup:['<path class="connection" stroke="black"/>','<path class="marker-source" fill="black" stroke="black" />','<path class="marker-target" fill="black" stroke="black" />','<path class="connection-wrap"/>','<g class="labels"/>','<g class="marker-vertices"/>','<g class="marker-arrowheads"/>','<g class="link-tools"/>'].join(""),labelMarkup:['<g class="label">',"<rect />","<text />","</g>"].join(""),toolMarkup:['<g class="link-tool">','<g class="tool-remove" event="remove">','<circle r="11" />','<path transform="scale(.8) translate(-16, -16)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z"/>',"<title>Remove link.</title>","</g>",'<g class="tool-options" event="link:options">','<circle r="11" transform="translate(25)"/>','<path fill="white" transform="scale(.55) translate(29, -16)" d="M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z"/>',"<title>Link options.</title>","</g>","</g>"].join(""),vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>"].join(""),arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<path class="marker-arrowhead" end="<%= end %>" d="M 26 0 L 0 13 L 26 26 z" />',"</g>"].join(""),defaults:{type:"link",source:{},target:{}},disconnect:function(){return this.set({source:e.point(0,0),target:e.point(0,0)})},label:function(a,c){a=a||0;var d=this.get("labels")||[];if(0===arguments.length||1===arguments.length)return d[a];var e=b.merge({},d[a],c),f=d.slice();return f[a]=e,this.set({labels:f})},translate:function(a,c,d){var e={},f=this.get("source"),g=this.get("target"),h=this.get("vertices");return f.id||(e.source={x:f.x+a,y:f.y+c}),g.id||(e.target={x:g.x+a,y:g.y+c}),h&&h.length&&(e.vertices=b.map(h,function(b){return{x:b.x+a,y:b.y+c}})),this.set(e,d)},reparent:function(a){var b;if(this.collection){var c=this.collection.get(this.get("source").id),d=this.collection.get(this.get("target").id),e=this.collection.get(this.get("parent"));c&&d&&(b=this.collection.getCommonAncestor(c,d)),!e||b&&b.id==e.id||e.unembed(this,a),b&&b.embed(this,a)}return b},isLink:function(){return!0},hasLoop:function(){var a=this.get("source").id,b=this.get("target").id;return a&&b&&a==b}}),a.dia.LinkView=a.dia.CellView.extend({className:function(){return b.unique(this.model.get("type").split(".").concat("link")).join(" ")},options:{shortLinkLength:100,doubleLinkTools:!1,longLinkLength:160,linkToolsOffset:40,doubleLinkToolsOffset:60},initialize:function(b){a.dia.CellView.prototype.initialize.apply(this,arguments),"function"!=typeof this.constructor.prototype.watchSource&&(this.constructor.prototype.watchSource=this.createWatcher("source"),this.constructor.prototype.watchTarget=this.createWatcher("target")),this._labelCache={},this._markerCache={},this.startListening()},startListening:function(){this.listenTo(this.model,"change:markup",this.render),this.listenTo(this.model,"change:smooth change:manhattan change:router change:connector",this.update),this.listenTo(this.model,"change:toolMarkup",function(){this.renderTools().updateToolsPosition()}),this.listenTo(this.model,"change:labels change:labelMarkup",function(){this.renderLabels().updateLabelPositions()}),this.listenTo(this.model,"change:vertices change:vertexMarkup",function(a,b,c){this.renderVertexMarkers(),(!c.translateBy||c.translateBy==this.model.id||this.model.hasLoop())&&this.update()}),this.listenTo(this.model,"change:source",function(a,b){this.watchSource(a,b).update()}),this.listenTo(this.model,"change:target",function(a,b){this.watchTarget(a,b).update()})},render:function(){this.$el.empty();var a=d(this.model.get("markup")||this.model.markup);if(b.isArray(a)||(a=[a]),this._V={},b.each(a,function(a){var b=a.attr("class");b&&(this._V[f.camelCase(b)]=a)},this),!this._V.connection)throw new Error("link: no connection path in the markup");return this.renderTools(),this.renderVertexMarkers(),this.renderArrowheadMarkers(),d(this.el).append(a),this.renderLabels(),this.watchSource(this.model,this.model.get("source")).watchTarget(this.model,this.model.get("target")).update(),this},renderLabels:function(){if(!this._V.labels)return this;this._labelCache={};var c=f(this._V.labels.node).empty(),e=this.model.get("labels")||[];if(!e.length)return this;var g=b.template(this.model.get("labelMarkup")||this.model.labelMarkup),h=d(g());return b.each(e,function(e,g){var i=h.clone().node;this._labelCache[g]=d(i);var j=f(i).find("text"),k=f(i).find("rect"),l=b.extend({"text-anchor":"middle","font-size":14},a.util.getByPath(e,"attrs/text","/"));j.attr(b.omit(l,"text")),b.isUndefined(l.text)||d(j[0]).text(l.text+""),c.append(i);var m=d(j[0]).bbox(!0,c[0]);d(j[0]).translate(0,-m.height/2);var n=b.extend({fill:"white",rx:3,ry:3},a.util.getByPath(e,"attrs/rect","/"));k.attr(b.extend(n,{x:m.x,y:m.y-m.height/2,width:m.width,height:m.height}))},this),this},renderTools:function(){if(!this._V.linkTools)return this;var a=f(this._V.linkTools.node).empty(),c=b.template(this.model.get("toolMarkup")||this.model.toolMarkup),e=d(c());if(a.append(e.node),this._toolCache=e,this.options.doubleLinkTools){var g=e.clone();a.append(g.node),this._tool2Cache=g}return this},renderVertexMarkers:function(){if(!this._V.markerVertices)return this;var a=f(this._V.markerVertices.node).empty(),c=b.template(this.model.get("vertexMarkup")||this.model.vertexMarkup);return b.each(this.model.get("vertices"),function(e,f){a.append(d(c(b.extend({idx:f},e))).node)}),this},renderArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;var a=f(this._V.markerArrowheads.node);a.empty();var c=b.template(this.model.get("arrowheadMarkup")||this.model.arrowheadMarkup);return this._V.sourceArrowhead=d(c({end:"source"})),this._V.targetArrowhead=d(c({end:"target"})),a.append(this._V.sourceArrowhead.node,this._V.targetArrowhead.node),this},update:function(){b.each(this.model.get("attrs"),function(a,c){var d=[];b.isObject(a.fill)&&(this.applyGradient(c,"fill",a.fill),d.push("fill")),b.isObject(a.stroke)&&(this.applyGradient(c,"stroke",a.stroke),d.push("stroke")),b.isObject(a.filter)&&(this.applyFilter(c,a.filter),d.push("filter")),d.length>0&&(d.unshift(a),a=b.omit.apply(b,d)),this.findBySelector(c).attr(a)},this);var a=this.route=this.findRoute(this.model.get("vertices")||[]);this._findConnectionPoints(a);var c=this.getPathData(a);return this._V.connection.attr("d",c),this._V.connectionWrap&&this._V.connectionWrap.attr("d",c),this._translateAndAutoOrientArrows(this._V.markerSource,this._V.markerTarget),this.updateLabelPositions(),this.updateToolsPosition(),this.updateArrowheadMarkers(),delete this.options.perpendicular,this.updatePostponed=!1,this},_findConnectionPoints:function(a){var c,d,f,g,h=b.first(a);c=this.getConnectionPoint("source",this.model.get("source"),h||this.model.get("target")).round();var i=b.last(a);d=this.getConnectionPoint("target",this.model.get("target"),i||c).round();var j=this._markerCache;this._V.markerSource&&(j.sourceBBox=j.sourceBBox||this._V.markerSource.bbox(!0),f=e.point(c).move(h||d,j.sourceBBox.width*this._V.markerSource.scale().sx*-1).round()),this._V.markerTarget&&(j.targetBBox=j.targetBBox||this._V.markerTarget.bbox(!0),g=e.point(d).move(i||c,j.targetBBox.width*this._V.markerTarget.scale().sx*-1).round()),j.sourcePoint=f||c,j.targetPoint=g||d,this.sourcePoint=c,this.targetPoint=d},updateLabelPositions:function(){if(!this._V.labels)return this;var a=this.model.get("labels")||[];if(!a.length)return this;var c=this._V.connection.node,d=c.getTotalLength();return b.isNaN(d)||b.each(a,function(a,b){var e=a.position;e=e>d?d:e,e=0>e?d+e:e,e=e>1?e:d*e;var f=c.getPointAtLength(e);this._labelCache[b].attr("transform","translate("+f.x+", "+f.y+")")},this),this},updateToolsPosition:function(){if(!this._V.linkTools)return this;var a="",b=this.options.linkToolsOffset,c=this.getConnectionLength();c<this.options.shortLinkLength&&(a="scale(.5)",b/=2);var d=this.getPointAtLength(b);if(this._toolCache.attr("transform","translate("+d.x+", "+d.y+") "+a),this.options.doubleLinkTools&&c>=this.options.longLinkLength){var e=this.options.doubleLinkToolsOffset||b;d=this.getPointAtLength(c-e),this._tool2Cache.attr("transform","translate("+d.x+", "+d.y+") "+a),this._tool2Cache.attr("visibility","visible")}else this.options.doubleLinkTools&&this._tool2Cache.attr("visibility","hidden");return this},updateArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;if("none"===f.css(this._V.markerArrowheads.node,"display"))return this;var a=this.getConnectionLength()<this.options.shortLinkLength?.5:1;return this._V.sourceArrowhead.scale(a),this._V.targetArrowhead.scale(a),this._translateAndAutoOrientArrows(this._V.sourceArrowhead,this._V.targetArrowhead),this},createWatcher:function(a){function c(b,c){c=c||{};var e=null,f=b.previous(a)||{};return f.id&&this.stopListening(this.paper.getModelById(f.id),"change",d),c.id&&(e=this.paper.getModelById(c.id),this.listenTo(e,"change",d)),d.call(this,e,{cacheOnly:!0}),this}var d=b.partial(this.onEndModelChange,a);return c},onEndModelChange:function(a,c,d){var f=!d.cacheOnly,g=this.model.get(a)||{};if(c){var h=this.constructor.makeSelector(g),i="source"==a?"target":"source",j=this.model.get(i)||{},k=j.id&&this.constructor.makeSelector(j);if(d.isLoop&&h==k)this[a+"BBox"]=this[i+"BBox"],this[a+"View"]=this[i+"View"],this[a+"Magnet"]=this[i+"Magnet"];else if(d.translateBy){var l=this[a+"BBox"];l.x+=d.tx,l.y+=d.ty}else{var m=this.paper.findViewByModel(g.id),n=m.el.querySelector(h);this[a+"BBox"]=m.getStrokeBBox(n),this[a+"View"]=m,this[a+"Magnet"]=n}if(d.isLoop&&d.translateBy&&this.model.isEmbeddedIn(c)&&!b.isEmpty(this.model.get("vertices"))&&(f=!1),!this.updatePostponed&&j.id){var o=this.paper.getModelById(j.id);d.isLoop=g.id==j.id,(d.isLoop||d.translateBy&&o.isEmbeddedIn(d.translateBy))&&(this.updatePostponed=!0,f=!1)}}else this[a+"BBox"]=e.rect(g.x||0,g.y||0,1,1),this[a+"View"]=this[a+"Magnet"]=null;this.lastEndChange=a,f&&this.update()},_translateAndAutoOrientArrows:function(a,c){a&&a.translateAndAutoOrient(this.sourcePoint,b.first(this.route)||this.targetPoint,this.paper.viewport),c&&c.translateAndAutoOrient(this.targetPoint,b.last(this.route)||this.sourcePoint,this.paper.viewport)},removeVertex:function(a){var c=b.clone(this.model.get("vertices"));return c&&c.length&&(c.splice(a,1),this.model.set("vertices",c,{ui:!0})),this},addVertex:function(a){for(var b,c=(this.model.get("vertices")||[]).slice(),e=c.slice(),f=this._V.connection.node.cloneNode(!1),g=f.getTotalLength(),h=20,i=c.length+1;i--&&(c.splice(i,0,a),d(f).attr("d",this.getPathData(this.findRoute(c))),b=f.getTotalLength(),b-g>h);)c=e.slice();return-1===i&&(i=0,c.splice(i,0,a)),this.model.set("vertices",c,{ui:!0}),i},sendToken:function(a,c,e){c=c||1e3,d(this.paper.viewport).append(a),d(a).animateAlongPath({dur:c+"ms",repeatCount:1},this._V.connection.node),b.delay(function(){d(a).remove(),e&&e()},c)},findRoute:function(c){var d=this.model.get("router");if(!d){if(!this.model.get("manhattan"))return c;d={name:"orthogonal"}}var e=a.routers[d.name];if(!b.isFunction(e))throw"unknown router: "+d.name;var f=e.call(this,c||[],d.args||{},this);return f},getPathData:function(c){var d=this.model.get("connector");if(d||(d=this.model.get("smooth")?{name:"smooth"}:{name:"normal"}),!b.isFunction(a.connectors[d.name]))throw"unknown connector: "+d.name;var e=a.connectors[d.name].call(this,this._markerCache.sourcePoint,this._markerCache.targetPoint,c||this.model.get("vertices")||{},d.args||{},this);return e},getConnectionPoint:function(a,c,d){var f;if(b.isEmpty(c)&&(c={x:0,y:0}),b.isEmpty(d)&&(d={x:0,y:0}),c.id){var g,h="source"===a?this.sourceBBox:this.targetBBox;if(d.id){var i="source"===a?this.targetBBox:this.sourceBBox;g=e.rect(i).intersectionWithLineFromCenterToPoint(e.rect(h).center()),g=g||e.rect(i).center()}else g=e.point(d);if(this.paper.options.perpendicularLinks||this.options.perpendicular){var j,k=e.rect(0,g.y,this.paper.options.width,1),l=e.rect(g.x,0,1,this.paper.options.height);if(k.intersect(e.rect(h)))switch(j=e.rect(h).sideNearestToPoint(g)){case"left":f=e.point(h.x,g.y);break;case"right":f=e.point(h.x+h.width,g.y);break;default:f=e.rect(h).center()}else if(l.intersect(e.rect(h)))switch(j=e.rect(h).sideNearestToPoint(g)){case"top":f=e.point(g.x,h.y);break;case"bottom":f=e.point(g.x,h.y+h.height);break;default:f=e.rect(h).center()}else f=e.rect(h).intersectionWithLineFromCenterToPoint(g),f=f||e.rect(h).center()}else if(this.paper.options.linkConnectionPoint){var m="target"===a?this.targetView:this.sourceView,n="target"===a?this.targetMagnet:this.sourceMagnet;f=this.paper.options.linkConnectionPoint(this,m,n,g)}else f=e.rect(h).intersectionWithLineFromCenterToPoint(g),f=f||e.rect(h).center()}else f=e.point(c);return f},getConnectionLength:function(){return this._V.connection.node.getTotalLength()},getPointAtLength:function(a){return this._V.connection.node.getPointAtLength(a)},_beforeArrowheadMove:function(){this.model.trigger("batch:start"),this._z=this.model.get("z"),this.model.toFront(),this.el.style.pointerEvents="none",this.paper.options.markAvailable&&this._markAvailableMagnets()},_afterArrowheadMove:function(){this._z&&(this.model.set("z",this._z,{ui:!0}),delete this._z),this.el.style.pointerEvents="visiblePainted",this.paper.options.markAvailable&&this._unmarkAvailableMagnets(),this.model.trigger("batch:stop")},_createValidateConnectionArgs:function(a){function b(a,b){return c[f]=a,c[f+1]=a.el===b?void 0:b,c}var c=[];c[4]=a,c[5]=this;var d,e=0,f=0;"source"===a?(e=2,d="target"):(f=2,d="source");var g=this.model.get(d);return g.id&&(c[e]=this.paper.findViewByModel(g.id),c[e+1]=g.selector&&c[e].el.querySelector(g.selector)),b},_markAvailableMagnets:function(){var a=this.paper.model.getElements(),c=this.paper.options.validateConnection;b.chain(a).map(this.paper.findViewByModel,this.paper).each(function(a){var e="false"!==a.el.getAttribute("magnet")&&c.apply(this.paper,this._validateConnectionArgs(a,null)),f=b.filter(a.el.querySelectorAll("[magnet]"),function(b){return c.apply(this.paper,this._validateConnectionArgs(a,b))},this);e&&d(a.el).addClass("available-magnet"),b.each(f,function(a){d(a).addClass("available-magnet")}),(e||f.length)&&d(a.el).addClass("available-cell")},this)},_unmarkAvailableMagnets:function(){b.each(this.paper.el.querySelectorAll(".available-cell, .available-magnet"),function(a){d(a).removeClass("available-magnet").removeClass("available-cell")})},startArrowheadMove:function(a){this._action="arrowhead-move",this._arrowhead=a,this._validateConnectionArgs=this._createValidateConnectionArgs(this._arrowhead),this._beforeArrowheadMove()},pointerdown:function(c,d,e){function f(a){return b.isObject(g)&&g[a]===!1?!1:!0}a.dia.CellView.prototype.pointerdown.apply(this,arguments),this._dx=d,this._dy=e;var g=b.isFunction(this.options.interactive)?this.options.interactive(this,"pointerdown"):this.options.interactive;if(g!==!1){var h=c.target.getAttribute("class");switch(h){case"marker-vertex":f("vertexMove")&&(this._action="vertex-move",this._vertexIdx=c.target.getAttribute("idx"));break;case"marker-vertex-remove":case"marker-vertex-remove-area":f("vertexRemove")&&this.removeVertex(c.target.getAttribute("idx"));break;case"marker-arrowhead":f("arrowheadMove")&&this.startArrowheadMove(c.target.getAttribute("end"));break;default:var i=c.target.parentNode.getAttribute("event");i?"remove"===i?this.model.remove():this.paper.trigger(i,c,this,d,e):f("vertexAdd")&&(this._vertexIdx=this.addVertex({x:d,y:e}),this._action="vertex-move")}this.paper.trigger("link:pointerdown",c,this,d,e)}},pointermove:function(c,f,g){switch(a.dia.CellView.prototype.pointermove.apply(this,arguments),this._action){case"vertex-move":var h=b.clone(this.model.get("vertices"));h[this._vertexIdx]={x:f,y:g},this.model.set("vertices",h,{ui:!0});break;case"arrowhead-move":if(this.paper.options.snapLinks){var i=this.paper.options.snapLinks.radius||50,j=this.paper.findViewsInArea({x:f-i,y:g-i,width:2*i,height:2*i});this._closestView&&this._closestView.unhighlight(this._closestEnd.selector,{connecting:!0,snapping:!0}),this._closestView=this._closestEnd=null;var k,l=e.point(f,g),m=Number.MAX_VALUE;b.each(j,function(a){"false"!==a.el.getAttribute("magnet")&&(k=a.model.getBBox().center().distance(l),i>k&&m>k&&this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(a,null))&&(m=k,this._closestView=a,this._closestEnd={id:a.model.id})),a.$("[magnet]").each(b.bind(function(b,c){var e=d(c).bbox(!1,this.paper.viewport);k=l.distance({x:e.x+e.width/2,y:e.y+e.height/2}),i>k&&m>k&&this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(a,c))&&(m=k,this._closestView=a,this._closestEnd={id:a.model.id,selector:a.getSelector(c),port:c.getAttribute("port")})},this))},this),this._closestView&&this._closestView.highlight(this._closestEnd.selector,{connecting:!0,snapping:!0}),this.model.set(this._arrowhead,this._closestEnd||{x:f,y:g},{ui:!0})}else{var n="mousemove"===c.type?c.target:document.elementFromPoint(c.clientX,c.clientY);this._targetEvent!==n&&(this._magnetUnderPointer&&this._viewUnderPointer.unhighlight(this._magnetUnderPointer,{connecting:!0}),this._viewUnderPointer=this.paper.findView(n),this._viewUnderPointer?(this._magnetUnderPointer=this._viewUnderPointer.findMagnet(n),this._magnetUnderPointer&&this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(this._viewUnderPointer,this._magnetUnderPointer))?this._magnetUnderPointer&&this._viewUnderPointer.highlight(this._magnetUnderPointer,{connecting:!0}):this._magnetUnderPointer=null):this._magnetUnderPointer=null),this._targetEvent=n,this.model.set(this._arrowhead,{x:f,y:g},{ui:!0})}}this._dx=f,this._dy=g},pointerup:function(b){a.dia.CellView.prototype.pointerup.apply(this,arguments),"arrowhead-move"===this._action&&(this.paper.options.snapLinks?(this._closestView&&this._closestView.unhighlight(this._closestEnd.selector,{connecting:!0,snapping:!0}),this._closestView=this._closestEnd=null):(this._magnetUnderPointer&&(this._viewUnderPointer.unhighlight(this._magnetUnderPointer,{connecting:!0}),this.model.set(this._arrowhead,{id:this._viewUnderPointer.model.id,selector:this._viewUnderPointer.getSelector(this._magnetUnderPointer),port:f(this._magnetUnderPointer).attr("port")},{ui:!0})),delete this._viewUnderPointer,delete this._magnetUnderPointer),this.paper.options.embeddingMode&&this.model.reparent()&&delete this._z,this._afterArrowheadMove()),delete this._action}},{makeSelector:function(a){var b='[model-id="'+a.id+'"]';return a.port?b+=' [port="'+a.port+'"]':a.selector&&(b+=" "+a.selector),b}})}),"object"==typeof exports&&(module.exports.Link=joint.dia.Link,module.exports.LinkView=joint.dia.LinkView),function(a,b){if("function"==typeof define&&define.amd)define(["JointJS","lodash","Backbone","Vectorizer","Geometry","jQuery"],b);else if("object"==typeof exports){var c=require("JointJS"),d=require("$")||require("jQuery"),e=require("Backbone"),f=require("lodash"),g=require("V")||require("Vectorizer"),h=require("G")||require("Geometry")||require("g");b(c,f,e,g,h,d)}else{var c=a.joint,d=a.$||a.jQuery,e=a.Backbone,f=a._,g=a.V||a.Vectorizer,h=a.G||a.Geometry||a.g;b(c,f,e,g,h,d)}}(this,function(a,b,c,d,e,f){a.dia.Paper=c.View.extend({className:"paper",options:{width:800,height:600,origin:{x:0,y:0},gridSize:50,perpendicularLinks:!1,elementView:a.dia.ElementView,linkView:a.dia.LinkView,snapLinks:!1,markAvailable:!1,defaultLink:new a.dia.Link,validateMagnet:function(a,b){return"passive"!==b.getAttribute("magnet")},validateConnection:function(b,c,d,e,f,g){return("target"===f?d:b)instanceof a.dia.ElementView},embeddingMode:!1,validateEmbedding:function(a,b){return!0},findParentBy:"bbox",frontParentOnly:!0},events:{mousedown:"pointerdown",dblclick:"mousedblclick",click:"mouseclick",touchstart:"pointerdown",mousemove:"pointermove",touchmove:"pointermove","mouseover .element":"cellMouseover","mouseover .link":"cellMouseover","mouseout .element":"cellMouseout","mouseout .link":"cellMouseout"},constructor:function(a){this._configure(a),c.View.apply(this,arguments)},_configure:function(a){this.options&&(a=b.extend({},b.result(this,"options"),a)),this.options=a},initialize:function(){b.bindAll(this,"addCell","sortCells","resetCells","pointerup","asyncRenderCells"),this.svg=d("svg").node,this.viewport=d("g").addClass("viewport").node,this.defs=d("defs").node,d(this.svg).append([this.viewport,this.defs]),this.$el.append(this.svg),this.setOrigin(),this.setDimensions(),this.listenTo(this.model,"add",this.onAddCell),this.listenTo(this.model,"reset",this.resetCells),this.listenTo(this.model,"sort",this.sortCells),f(document).on("mouseup touchend",this.pointerup),this._mousemoved=!1,this.on({"cell:highlight":this.onCellHighlight,"cell:unhighlight":this.onCellUnhighlight})},remove:function(){this.removeCells(),f(document).off("mouseup touchend",this.pointerup),c.View.prototype.remove.call(this)},setDimensions:function(a,b){a=this.options.width=a||this.options.width,b=this.options.height=b||this.options.height,d(this.svg).attr({width:a,height:b}),this.trigger("resize",a,b)},setOrigin:function(a,b){this.options.origin.x=a||0,this.options.origin.y=b||0,d(this.viewport).translate(a,b,{absolute:!0}),this.trigger("translate",a,b)},fitToContent:function(a,c,e,f){b.isObject(a)?(f=a,a=f.gridWidth||1,c=f.gridHeight||1,e=f.padding||0):(f=f||{},a=a||1,c=c||1,e=e||0);var g=d(this.viewport).bbox(!0,this.svg),h=d(this.viewport).scale();g.x*=h.sx,g.y*=h.sy,g.width*=h.sx,g.height*=h.sy;var i=Math.max(Math.ceil((g.width+g.x)/a),1)*a,j=Math.max(Math.ceil((g.height+g.y)/c),1)*c,k=0,l=0;("negative"==f.allowNewOrigin&&g.x<0||"positive"==f.allowNewOrigin&&g.x>=0||"any"==f.allowNewOrigin)&&(k=Math.ceil(-g.x/a)*a,k+=e,i+=k),("negative"==f.allowNewOrigin&&g.y<0||"positive"==f.allowNewOrigin&&g.y>=0||"any"==f.allowNewOrigin)&&(l=Math.ceil(-g.y/c)*c,l+=e,j+=l),i+=e,j+=e,i=Math.max(i,f.minWidth||0),j=Math.max(j,f.minHeight||0);var m=i!=this.options.width||j!=this.options.height,n=k!=this.options.origin.x||l!=this.options.origin.y;n&&this.setOrigin(k,l),m&&this.setDimensions(i,j)},scaleContentToFit:function(a){var c=this.getContentBBox();if(c.width&&c.height){a=a||{},b.defaults(a,{padding:0,preserveAspectRatio:!0,scaleGrid:null,minScale:0,maxScale:Number.MAX_VALUE});var f=a.padding,g=a.minScaleX||a.minScale,h=a.maxScaleX||a.maxScale,i=a.minScaleY||a.minScale,j=a.maxScaleY||a.maxScale,k=a.fittingBBox||{x:this.options.origin.x,y:this.options.origin.y,width:this.options.width,height:this.options.height};k=e.rect(k).moveAndExpand({x:f,y:f,width:-2*f,height:-2*f});var l=d(this.viewport).scale(),m=k.width/c.width*l.sx,n=k.height/c.height*l.sy;if(a.preserveAspectRatio&&(m=n=Math.min(m,n)),a.scaleGrid){var o=a.scaleGrid;m=o*Math.floor(m/o),n=o*Math.floor(n/o)}m=Math.min(h,Math.max(g,m)),n=Math.min(j,Math.max(i,n)),this.scale(m,n);var p=this.getContentBBox(),q=k.x-p.x,r=k.y-p.y;this.setOrigin(q,r)}},getContentBBox:function(){var a=this.viewport.getBoundingClientRect(),b=this.viewport.getScreenCTM(),c=this.viewport.getCTM(),d=e.rect({x:a.left-b.e+c.e,y:a.top-b.f+c.f,width:a.width,height:a.height});return d},createViewForModel:function(b){var c,d=b.get("type"),e=d.split(".")[0],f=d.split(".")[1];return c=a.shapes[e]&&a.shapes[e][f+"View"]?new a.shapes[e][f+"View"]({model:b,interactive:this.options.interactive}):b instanceof a.dia.Element?new this.options.elementView({model:b,interactive:this.options.interactive}):new this.options.linkView({model:b,interactive:this.options.interactive})},onAddCell:function(a,c,d){if(this.options.async&&d.async!==!1&&b.isNumber(d.position)){if(this._asyncCells=this._asyncCells||[],this._asyncCells.push(a),0==d.position){if(this._frameId)throw"another asynchronous rendering in progress";this.asyncRenderCells(this._asyncCells),delete this._asyncCells}}else this.addCell(a)},addCell:function(a){var b=this.createViewForModel(a);d(this.viewport).append(b.el),b.paper=this,b.render(),f(b.el).find("image").on("dragstart",function(){return!1})},beforeRenderCells:function(b){return b.sort(function(b,c){return b instanceof a.dia.Link?1:-1}),b},afterRenderCells:function(){this.sortCells()},resetCells:function(c){f(this.viewport).empty();var d=c.models.slice();d=this.beforeRenderCells(d),this._frameId&&(a.util.cancelFrame(this._frameId),delete this._frameId),this.options.async?this.asyncRenderCells(d):(b.each(d,this.addCell,this),this.sortCells())},removeCells:function(){this.model.get("cells").each(function(a){var b=this.findViewByModel(a);b&&b.remove()},this)},asyncBatchAdded:b.identity,asyncRenderCells:function(c,d){var e=!1;this._frameId&&(b.each(b.range(this.options.async&&this.options.async.batchSize||50),function(){var a=c.shift();e=!a,e||this.addCell(a)},this),this.asyncBatchAdded()),
e?(delete this._frameId,this.afterRenderCells(),this.trigger("render:done",d)):this._frameId=a.util.nextFrame(b.bind(function(){this.asyncRenderCells(c,d)},this))},sortCells:function(){var a=f(this.viewport).children("[model-id]"),b=this.model.get("cells");this.sortElements(a,function(a,c){var d=b.get(f(a).attr("model-id")),e=b.get(f(c).attr("model-id"));return(d.get("z")||0)>(e.get("z")||0)?1:-1})},sortElements:function(a,b){var c=f(a),d=c.map(function(){var a=this,b=a.parentNode,c=b.insertBefore(document.createTextNode(""),a.nextSibling);return function(){if(b===this)throw new Error("You can't sort elements if any one is a descendant of another.");b.insertBefore(this,c),b.removeChild(c)}});return Array.prototype.sort.call(c,b).each(function(a){d[a].call(this)})},scale:function(a,c,e,f){c=c||a,b.isUndefined(e)&&(e=0,f=0),d(this.viewport).attr("transform","");var g=this.options.origin.x,h=this.options.origin.y;if(e||f||g||h){var i=g-e*(a-1),j=h-f*(c-1);this.setOrigin(i,j)}return d(this.viewport).scale(a,c),this.trigger("scale",a,c,e,f),this},rotate:function(a,c,e){if(b.isUndefined(c)){var f=this.viewport.getBBox();c=f.width/2,e=f.height/2}d(this.viewport).rotate(a,c,e)},findView:function(a){var b=this.$(a);return 0===b.length||b[0]===this.el?void 0:b.data("view")?b.data("view"):this.findView(b.parent())},findViewByModel:function(a){var c=b.isString(a)?a:a.id,d=this.$('[model-id="'+c+'"]');return d.length?d.data("view"):void 0},findViewsFromPoint:function(a){a=e.point(a);var c=b.map(this.model.getElements(),this.findViewByModel);return b.filter(c,function(b){return b&&e.rect(d(b.el).bbox(!1,this.viewport)).containsPoint(a)},this)},findViewsInArea:function(a){a=e.rect(a);var c=b.map(this.model.getElements(),this.findViewByModel);return b.filter(c,function(b){return b&&a.intersect(e.rect(d(b.el).bbox(!1,this.viewport)))},this)},getModelById:function(a){return this.model.getCell(a)},snapToGrid:function(a){var b=d(this.viewport).toLocalPoint(a.x,a.y);return{x:e.snapToGrid(b.x,this.options.gridSize),y:e.snapToGrid(b.y,this.options.gridSize)}},getDefaultLink:function(a,c){return b.isFunction(this.options.defaultLink)?this.options.defaultLink.call(this,a,c):this.options.defaultLink.clone()},onCellHighlight:function(a,b){d(b).addClass("highlighted")},onCellUnhighlight:function(a,b){d(b).removeClass("highlighted")},mousedblclick:function(b){b.preventDefault(),b=a.util.normalizeEvent(b);var c=this.findView(b.target),d=this.snapToGrid({x:b.clientX,y:b.clientY});c?c.pointerdblclick(b,d.x,d.y):this.trigger("blank:pointerdblclick",b,d.x,d.y)},mouseclick:function(b){if(!this._mousemoved){b=a.util.normalizeEvent(b);var c=this.findView(b.target),d=this.snapToGrid({x:b.clientX,y:b.clientY});c?c.pointerclick(b,d.x,d.y):this.trigger("blank:pointerclick",b,d.x,d.y)}this._mousemoved=!1},pointerdown:function(b){b=a.util.normalizeEvent(b);var c=this.findView(b.target),d=this.snapToGrid({x:b.clientX,y:b.clientY});c?(this.sourceView=c,c.pointerdown(b,d.x,d.y)):this.trigger("blank:pointerdown",b,d.x,d.y)},pointermove:function(b){if(b.preventDefault(),b=a.util.normalizeEvent(b),this.sourceView){this._mousemoved=!0;var c=this.snapToGrid({x:b.clientX,y:b.clientY});this.sourceView.pointermove(b,c.x,c.y)}},pointerup:function(b){b=a.util.normalizeEvent(b);var c=this.snapToGrid({x:b.clientX,y:b.clientY});this.sourceView?(this.sourceView.pointerup(b,c.x,c.y),this.sourceView=null):this.trigger("blank:pointerup",b,c.x,c.y)},cellMouseover:function(b){b=a.util.normalizeEvent(b);var c=this.findView(b.target);c&&c.mouseover(b)},cellMouseout:function(b){b=a.util.normalizeEvent(b);var c=this.findView(b.target);c&&c.mouseout(b)}})}),function(a,b){if("function"==typeof define&&define.amd)define(["JointJS","lodash","Backbone","Vectorizer","Geometry","jQuery"],b);else if("object"==typeof exports){var c=require("JointJS"),d=require("$")||require("jQuery"),e=require("Backbone"),f=require("lodash"),g=require("V")||require("Vectorizer"),h=require("G")||require("Geometry")||require("g");module.exports=b(c,f,e,g,h,d)}else{var c=a.joint,d=a.$||a.jQuery,e=a.Backbone,f=a._,g=a.V||a.Vectorizer,h=a.G||a.Geometry||a.g;b(c,f,e,g,h,d)}}(this,function(a,b,c,d,e,f){a.shapes.basic={},a.shapes.basic.Generic=a.dia.Element.extend({defaults:a.util.deepSupplement({type:"basic.Generic",attrs:{".":{fill:"#FFFFFF",stroke:"none"}}},a.dia.Element.prototype.defaults)}),a.shapes.basic.Rect=a.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><rect/></g><text/></g>',defaults:a.util.deepSupplement({type:"basic.Rect",attrs:{rect:{fill:"#FFFFFF",stroke:"black",width:100,height:60},text:{"font-size":14,text:"","ref-x":.5,"ref-y":.5,ref:"rect","y-alignment":"middle","x-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},a.shapes.basic.Generic.prototype.defaults)}),a.shapes.basic.TextView=a.dia.ElementView.extend({initialize:function(){a.dia.ElementView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:attrs",this.resize)}}),a.shapes.basic.Text=a.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><text/></g></g>',defaults:a.util.deepSupplement({type:"basic.Text",attrs:{text:{"font-size":18,fill:"black"}}},a.shapes.basic.Generic.prototype.defaults)}),a.shapes.basic.Circle=a.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><circle/></g><text/></g>',defaults:a.util.deepSupplement({type:"basic.Circle",size:{width:60,height:60},attrs:{circle:{fill:"#FFFFFF",stroke:"black",r:30,transform:"translate(30, 30)"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,ref:"circle","y-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},a.shapes.basic.Generic.prototype.defaults)}),a.shapes.basic.Image=a.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><image/></g><text/></g>',defaults:a.util.deepSupplement({type:"basic.Image",attrs:{text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,ref:"image","y-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},a.shapes.basic.Generic.prototype.defaults)}),a.shapes.basic.Path=a.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><path/></g><text/></g>',defaults:a.util.deepSupplement({type:"basic.Path",size:{width:60,height:60},attrs:{path:{fill:"#FFFFFF",stroke:"black"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,ref:"path","y-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},a.shapes.basic.Generic.prototype.defaults)}),a.shapes.basic.Rhombus=a.shapes.basic.Path.extend({defaults:a.util.deepSupplement({type:"basic.Rhombus",attrs:{path:{d:"M 30 0 L 60 30 30 60 0 30 z"},text:{"ref-y":.5}}},a.shapes.basic.Path.prototype.defaults)}),a.shapes.basic.PortsModelInterface={initialize:function(){this.updatePortsAttrs(),this.on("change:inPorts change:outPorts",this.updatePortsAttrs,this),this.constructor.__super__.constructor.__super__.initialize.apply(this,arguments)},updatePortsAttrs:function(a){var c=this.get("attrs");b.each(this._portSelectors,function(a){c[a]&&delete c[a]}),this._portSelectors=[];var d={};b.each(this.get("inPorts"),function(a,c,e){var f=this.getPortAttrs(a,c,e.length,".inPorts","in");this._portSelectors=this._portSelectors.concat(b.keys(f)),b.extend(d,f)},this),b.each(this.get("outPorts"),function(a,c,e){var f=this.getPortAttrs(a,c,e.length,".outPorts","out");this._portSelectors=this._portSelectors.concat(b.keys(f)),b.extend(d,f)},this),this.attr(d,{silent:!0}),this.processPorts(),this.trigger("process:ports")},getPortSelector:function(a){var b=".inPorts",c=this.get("inPorts").indexOf(a);if(0>c&&(b=".outPorts",c=this.get("outPorts").indexOf(a),0>c))throw new Error("getPortSelector(): Port doesn't exist.");return b+">g:nth-child("+(c+1)+")>circle"}},a.shapes.basic.PortsViewInterface={initialize:function(){this.listenTo(this.model,"process:ports",this.update),a.dia.ElementView.prototype.initialize.apply(this,arguments)},update:function(){this.renderPorts(),a.dia.ElementView.prototype.update.apply(this,arguments)},renderPorts:function(){var a=this.$(".inPorts").empty(),c=this.$(".outPorts").empty(),e=b.template(this.model.portMarkup);b.each(b.filter(this.model.ports,function(a){return"in"===a.type}),function(b,c){a.append(d(e({id:c,port:b})).node)}),b.each(b.filter(this.model.ports,function(a){return"out"===a.type}),function(a,b){c.append(d(e({id:b,port:a})).node)})}},a.shapes.basic.TextBlock=a.shapes.basic.Generic.extend({markup:['<g class="rotatable"><g class="scalable"><rect/></g><switch>','<foreignObject requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" class="fobj">','<body xmlns="http://www.w3.org/1999/xhtml"><div/></body>',"</foreignObject>",'<text class="content"/>',"</switch></g>"].join(""),defaults:a.util.deepSupplement({type:"basic.TextBlock",attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:80,height:100},text:{fill:"#000000","font-size":14,"font-family":"Arial, helvetica, sans-serif"},".content":{text:"",ref:"rect","ref-x":.5,"ref-y":.5,"y-alignment":"middle","x-alignment":"middle"}},content:""},a.shapes.basic.Generic.prototype.defaults),initialize:function(){"undefined"!=typeof SVGForeignObjectElement&&(this.setForeignObjectSize(this,this.get("size")),this.setDivContent(this,this.get("content")),this.listenTo(this,"change:size",this.setForeignObjectSize),this.listenTo(this,"change:content",this.setDivContent)),a.shapes.basic.Generic.prototype.initialize.apply(this,arguments)},setForeignObjectSize:function(a,c){a.attr({".fobj":b.clone(c),div:{style:b.clone(c)}})},setDivContent:function(a,b){a.attr({div:{html:b}})}}),a.shapes.basic.TextBlockView=a.dia.ElementView.extend({initialize:function(){a.dia.ElementView.prototype.initialize.apply(this,arguments),"undefined"==typeof SVGForeignObjectElement&&(this.noSVGForeignObjectElement=!0,this.listenTo(this.model,"change:content",function(a){this.updateContent(a)}))},update:function(c,d){if(this.noSVGForeignObjectElement){var e=this.model,f=b.omit(d||e.get("attrs"),".content");a.dia.ElementView.prototype.update.call(this,e,f),(!d||b.has(d,".content"))&&this.updateContent(e,d)}else a.dia.ElementView.prototype.update.call(this,e,d)},updateContent:function(c,d){var e=b.merge({},(d||c.get("attrs"))[".content"]);delete e.text;var f=a.util.breakText(c.get("content"),c.get("size"),e,{svgDocument:this.paper.svg}),g=a.util.setByPath({},".content",e,"/");g[".content"].text=f,a.dia.ElementView.prototype.update.call(this,c,g)}})}),function(a,b){if("function"==typeof define&&define.amd)define(["JointJS","lodash","Backbone","Vectorizer","Geometry","jQuery"],b);else if("object"==typeof exports){var c=require("JointJS"),d=require("$")||require("jQuery"),e=require("Backbone"),f=require("lodash"),g=require("V")||require("Vectorizer"),h=require("G")||require("Geometry")||require("g");b(c,f,e,g,h,d)}else{var c=a.joint,d=a.$||a.jQuery,e=a.Backbone,f=a._,g=a.V||a.Vectorizer,h=a.G||a.Geometry||a.g;b(c,f,e,g,h,d)}}(this,function(a,b,c,d,e,f){a.routers.orthogonal=function(){function a(a,b){return a.y<b.y&&a.x===b.x?"down":a.y>b.y&&a.x===b.x?"up":a.x<b.x&&a.y===b.y?"right":"left"}function c(a,c,d){var e;if(e=a.x<c.x?a.y>c.y?["up","right"]:a.y<c.y?["down","right"]:["right"]:a.x>c.x?a.y>c.y?["up","left"]:a.y<c.y?["down","left"]:["left"]:a.y>c.y?["up"]:["down"],b.contains(e,d))return d;var f=b.first(e);switch(d){case"down":if("up"===f)return b.last(e);break;case"up":if("down"===f)return b.last(e);break;case"left":if("right"===f)return b.last(e);break;case"right":if("left"===f)return b.last(e)}return f}function d(a,b,d){var e=c(a,b,d);return"down"===e||"up"===e?{x:a.x,y:b.y,d:e}:{x:b.x,y:a.y,d:e}}function f(c){c=(c||[]).slice();var f=[],i=g.center(),j=h.center();c.length||(Math.abs(i.x-j.x)<g.width/2||Math.abs(i.y-j.y)<g.height/2)&&(c=[{x:Math.min(i.x,j.x)+Math.abs(i.x-j.x)/2,y:Math.min(i.y,j.y)+Math.abs(i.y-j.y)/2}]),c.unshift(i),c.push(j);for(var k,l,m,n,o=0;o<c.length-1;o++){m=c[o],n=c[o+1],l=b.last(f),o>0&&(k=m,k.d=l?a(l,m):"top",f.push(k),l=k);var p=l&&l.d;k=d(m,n,p),e.point(k).equals(e.point(m))||e.point(k).equals(e.point(n))||f.push(k)}return f}var g,h;return function(a){return g=this.sourceBBox,h=this.targetBBox,f(a)}}()}),function(a,b){if("function"==typeof define&&define.amd)define(["JointJS","lodash","Backbone","Vectorizer","Geometry","jQuery"],b);else if("object"==typeof exports){var c=require("JointJS"),d=require("$")||require("jQuery"),e=require("Backbone"),f=require("lodash"),g=require("V")||require("Vectorizer"),h=require("G")||require("Geometry")||require("g");b(c,f,e,g,h,d)}else{var c=a.joint,d=a.$||a.jQuery,e=a.Backbone,f=a._,g=a.V||a.Vectorizer,h=a.G||a.Geometry||a.g;b(c,f,e,g,h,d)}}(this,function(a,b,c,d,e,f){a.routers.manhattan=function(){"use strict";function a(a,b){for(var c,d=[],e={x:0,y:0},f=b;c=a[f];){var g=c.difference(f);g.equals(e)||(d.unshift(f),e=g),f=c}return d.unshift(f),d}function c(a,c,d){var f=d.step,g=a.center(),h=b.chain(d.directionMap).pick(c).map(function(b){var c=b.x*a.width/2,d=b.y*a.height/2,h=e.point(g).offset(c,d).snapToGrid(f);return a.containsPoint(h)&&h.offset(b.x*f,b.y*f),h}).value();return h}function d(a,b,c){var d=360/c,e=Math.floor(a.theta(b)/d);return c-e}function f(f,g,h,i){var j=i.reversed?i.endDirections:i.startDirections,k=i.reversed?i.startDirections:i.endDirections,l=f instanceof e.rect?c(f,j,i):[f],m=g instanceof e.rect?c(g,k,i):[g],n=l.length>1?f.center():l[0],o=m.length>1?g.center():m[0],p=b.filter(m,function(a){var c=e.point(a).snapToGrid(i.mapGridSize).toString(),d=b.every(h[c],function(b){return!b.containsPoint(a)});return d});if(p.length)for(var q=i.step,r=i.penalties,s=b.chain(p).invoke("snapToGrid",q).min(function(a){return i.estimateCost(n,a)}).value(),t={},u={},v={},w=i.directions,x=w.length,y=x/2,z=i.previousDirIndexes||{},A={},B={},C=b.chain(l).invoke("snapToGrid",q).each(function(a){var b=a.toString();u[b]=0,v[b]=i.estimateCost(a,s),z[b]=z[b]||d(n,a,x),B[b]=!0}).map(function(a){return a.toString()}).sortBy(function(a){return v[a]}).value(),D=i.maximumLoops,E=i.maxAllowedDirectionChange;C.length&&D--;){var F=C[0],G=e.point(F);if(s.equals(G))return i.previousDirIndexes=b.pick(z,F),a(t,G);C.splice(0,1),B[N]=null,A[N]=!0;for(var H=z[F],I=u[F],J=0;x>J;J++){var K=Math.abs(J-H);if(K>y&&(K=x-K),!(K>E)){var L=w[J],M=e.point(G).offset(L.offsetX,L.offsetY),N=M.toString();if(!A[N]){var O=e.point(M).snapToGrid(i.mapGridSize).toString(),P=b.every(h[O],function(a){return!a.containsPoint(M)});if(P){var Q=b.has(B,N),R=I+L.cost;if((!Q||R<u[N])&&(t[N]=G,z[N]=J,u[N]=R,v[N]=R+i.estimateCost(M,s)+r[K],!Q)){var S=b.sortedIndex(C,N,function(a){return v[a]});C.splice(S,0,N),B[N]=!0}}}}}}return i.fallbackRoute(n,o,i)}function g(a,c){c.directions=b.result(c,"directions"),c.penalties=b.result(c,"penalties"),c.paddingBox=b.result(c,"paddingBox"),this.options.perpendicular=!!c.perpendicular;var d=c.reversed="source"===this.lastEndChange,g=e.rect(d?this.targetBBox:this.sourceBBox),h=e.rect(d?this.sourceBBox:this.targetBBox);g.moveAndExpand(c.paddingBox),h.moveAndExpand(c.paddingBox);var i=this.model,j=this.paper.model,k=b.chain(c.excludeEnds).map(i.get,i).pluck("id").map(j.getCell,j).value(),l=c.mapGridSize,m=b.chain(j.getElements()).difference(k).reject(function(a){return b.contains(c.excludeTypes,a.get("type"))}).invoke("getBBox").invoke("moveAndExpand",c.paddingBox).foldl(function(a,b){for(var c=b.origin().snapToGrid(l),d=b.corner().snapToGrid(l),e=c.x;e<=d.x;e+=l)for(var f=c.y;f<=d.y;f+=l){var g=e+"@"+f;a[g]=a[g]||[],a[g].push(b)}return a},{}).value(),n=[],o=b.map(a,e.point);d&&o.reverse();for(var p=g.center(),q=0,r=o.length;r>=q;q++){var s=null,t=u||g,u=o[q];if(!u){u=h;var v=!this.model.get("source").id||!this.model.get("target").id;if(v&&b.isFunction(c.draggingRoute)){var w=t instanceof e.rect?t.center():t;s=c.draggingRoute(w,u.origin(),c)}}s=s||f(t,u,m,c);var x=b.first(s);x&&x.equals(p)&&s.shift(),p=b.last(s)||p,n=n.concat(s)}return d?n.reverse():n}var h={step:10,perpendicular:!0,mapGridSize:100,excludeEnds:[],excludeTypes:["basic.Text"],maximumLoops:500,startDirections:["left","right","top","bottom"],endDirections:["left","right","top","bottom"],directionMap:{right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0},top:{x:0,y:-1}},maxAllowedDirectionChange:1,paddingBox:function(){var a=this.step;return{x:-a,y:-a,width:2*a,height:2*a}},directions:function(){var a=this.step;return[{offsetX:a,offsetY:0,cost:a},{offsetX:0,offsetY:a,cost:a},{offsetX:-a,offsetY:0,cost:a},{offsetX:0,offsetY:-a,cost:a}]},penalties:function(){return[0,this.step/2,this.step]},estimateCost:function(a,b){return a.manhattanDistance(b)},fallbackRoute:function(a,b,c){var d=c.prevDirIndexes||{},f=(d[a]||0)%2?e.point(a.x,b.y):e.point(b.x,a.y);return[f,b]},draggingRoute:null};return function(a,c,d){return g.call(d,a,b.extend({},h,c))}}()}),function(a,b){if("function"==typeof define&&define.amd)define(["JointJS","lodash","Backbone","Vectorizer","Geometry","jQuery"],b);else if("object"==typeof exports){var c=require("JointJS"),d=require("$")||require("jQuery"),e=require("Backbone"),f=require("lodash"),g=require("V")||require("Vectorizer"),h=require("G")||require("Geometry")||require("g");b(c,f,e,g,h,d)}else{var c=a.joint,d=a.$||a.jQuery,e=a.Backbone,f=a._,g=a.V||a.Vectorizer,h=a.G||a.Geometry||a.g;b(c,f,e,g,h,d)}}(this,function(a,b,c,d,e,f){a.routers.metro=function(){if(!b.isFunction(a.routers.manhattan))throw"Metro requires the manhattan router.";var c={diagonalCost:null,directions:function(){var a=this.step,b=this.diagonalCost||Math.ceil(Math.sqrt(a*a<<1));return[{offsetX:a,offsetY:0,cost:a},{offsetX:a,offsetY:a,cost:b},{offsetX:0,offsetY:a,cost:a},{offsetX:-a,offsetY:a,cost:b},{offsetX:-a,offsetY:0,cost:a},{offsetX:-a,offsetY:-a,cost:b},{offsetX:0,offsetY:-a,cost:a},{offsetX:a,offsetY:-a,cost:b}]},fallbackRoute:function(a,b,c){var d=a.theta(b),f={x:b.x,y:a.y},g={x:a.x,y:b.y};if(d%180>90){var h=f;f=g,g=h}var i=45>d%90?f:g,j=e.line(a,i),k=90*Math.ceil(d/90),l=e.point.fromPolar(j.squaredLength(),e.toRad(k+135),i),m=e.line(b,l),n=j.intersection(m);return n?[n.round(),b]:[b]}};return function(d,e,f){return a.routers.manhattan(d,b.extend({},c,e),f)}}()}),function(a,b){if("function"==typeof define&&define.amd)define(["JointJS","lodash"],b);else if("object"==typeof exports){var c=require("JointJS"),d=require("lodash");b(c,d)}else{var c=a.joint,d=a._;b(c,d)}}(this,function(a,b,c,d,e,f){a.connectors.normal=function(a,c,d){var e=["M",a.x,a.y];return b.each(d,function(a){e.push(a.x,a.y)}),e.push(c.x,c.y),e.join(" ")}}),function(a,b){if("function"==typeof define&&define.amd)define(["JointJS","lodash","Geometry"],b);else if("object"==typeof exports){var c=require("JointJS"),d=require("lodash"),e=require("G")||require("Geometry")||require("g");b(c,d,e)}else{var c=a.joint,d=a._,e=a.G||a.Geometry||a.g;b(c,d,e)}}(this,function(a,b,c){a.connectors.rounded=function(a,d,e,f){var g,h,i,j,k,l,m=f.radius||10,n=["M",a.x,a.y];return b.each(e,function(b,f){k=e[f-1]||a,l=e[f+1]||d,i=j||c.point(b).distance(k)/2,j=c.point(b).distance(l)/2,g=c.point(b).move(k,-Math.min(m,i)).round(),h=c.point(b).move(l,-Math.min(m,j)).round(),n.push(g.x,g.y,"S",b.x,b.y,h.x,h.y,"L")}),n.push(d.x,d.y),n.join(" ")}}),function(a,b){if("function"==typeof define&&define.amd)define(["JointJS"],b);else if("object"==typeof exports){var c=require("JointJS");b(c)}else{var c=a.joint;b(c)}}(this,function(a){a.connectors.smooth=function(a,b,c){var d;if(c.length)d=g.bezier.curveThroughPoints([a].concat(c).concat([b]));else{var e=a.x<b.x?b.x-(b.x-a.x)/2:a.x-(a.x-b.x)/2;d=["M",a.x,a.y,"C",e,a.y,e,b.y,b.x,b.y]}return d.join(" ")}});